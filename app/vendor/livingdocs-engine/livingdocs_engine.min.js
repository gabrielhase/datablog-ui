(function(){var a,b,c,d,e,f,g,h,i,j,k,l,m,n,o,p,q,r,s,t,u,v,w,x,y,z,A,B,C,D,E,F,G,H,I,J,K,L,M,N,O=[].slice,P={}.hasOwnProperty,Q=function(a,b){function c(){this.constructor=a}for(var d in b)P.call(b,d)&&(a[d]=b[d]);return c.prototype=b.prototype,a.prototype=new c,a.__super__=b.prototype,a};!function(){var a,b,c,d,e;this.config={wordSeparators:"./\\()\"':,.;<>~!#%^&*|+=[]{}`~?",singleLineBreak:/^<br\s*\/?>\s*$/,zeroWidthCharacter:"ï»¿",attributePrefix:"data",html:{css:{section:"doc-section",snippet:"doc-snippet",editable:"doc-editable","interface":"doc-ui",snippetHighlight:"doc-snippet-highlight",containerHighlight:"doc-container-highlight",draggedPlaceholder:"doc-dragged-placeholder",dragged:"doc-dragged",beforeDrop:"doc-before-drop",afterDrop:"doc-after-drop",preventSelection:"doc-no-selection",maximizedContainer:"doc-js-maximized-container",interactionBlocker:"doc-interaction-blocker"},attr:{template:"data-doc-template",placeholder:"data-doc-placeholder"}},kickstart:{attr:{styles:"doc-styles"}},directives:{container:{attr:"doc-container",renderedAttr:"calculated later",elementDirective:!0,defaultName:"default"},editable:{attr:"doc-editable",renderedAttr:"calculated later",elementDirective:!0,defaultName:"default"},image:{attr:"doc-image",renderedAttr:"calculated later",elementDirective:!0,defaultName:"image"},html:{attr:"doc-html",renderedAttr:"calculated later",elementDirective:!0,defaultName:"default"},optional:{attr:"doc-optional",renderedAttr:"calculated later",elementDirective:!1}},animations:{optionals:{show:function(a){return a.slideDown(250)},hide:function(a){return a.slideUp(250)}}},editable:{insertSnippet:"text"}},this.docClass=config.html.css,this.docAttr=config.html.attr,this.docDirective={},this.templateAttrLookup={},d=config.directives,e=[];for(a in d)c=d[a],this.config.attributePrefix&&(b=""+config.attributePrefix+"-"),c.renderedAttr=""+(b||"")+c.attr,this.docDirective[a]=c.renderedAttr,e.push(this.templateAttrLookup[c.attr]=a);return e}(),w=function(a,b){return a?void 0:J.error(b)},y=function(a){return function(b,c){var d,e,f;return"string"==typeof c&&(f=b[c],c=b,b=f),d=Array.prototype.slice.call(arguments,2),e=function(){return b.apply(c||this,d.concat(Array.prototype.slice.call(arguments))),a}}},D=function(){return{callOnce:function(a,b){var c;return c=function(){var d;return d=1<=arguments.length?O.call(arguments,0):[],a.remove(c),b.apply(this,d)},a.add(c),c}}}(),E=function(){var a,b;return a=b=void 0,{next:function(c){var d;return null==c&&(c="doc"),d=Date.now().toString(32),b===d?a+=1:(a=0,b=d),""+c+"-"+d+a}}}(),F=function(){return{empty:/^\s*$/,whitespace:/\s+/g,normalizeWhitespace:!0,compare:function(a,b){var c,d,e;for("string"==typeof a&&(a=$(a)),"string"==typeof b&&(b=$(b)),a.jquery&&(a=a[0]),b.jquery&&(b=b[0]),d=this.iterateComparables(a),e=this.iterateComparables(b),c=!0;c;)c=this.compareNode(a=d(),b=e());return null==a&&null==b?!0:!1},compareNode:function(a,b){if(null!=a&&null!=b&&a.nodeType===b.nodeType)switch(a.nodeType){case 1:return this.compareElement(a,b);case 3:return this.compareText(a,b);default:return J.error("HtmlCompare: nodeType "+a.nodeType+" not supported")}},compareElement:function(a,b){return this.compareTag(a,b)&&this.compareAttributes(a,b)?!0:void 0},compareText:function(a,b){var c,d;return this.normalizeWhitespace?(c=$.trim(a.textContent).replace(this.whitespace," "),d=$.trim(b.textContent).replace(this.whitespace," "),c===d):a.nodeValue===b.nodeValue},compareTag:function(a,b){return this.getTag(a)===this.getTag(b)},getTag:function(a){return a.namespaceURI+":"+a.localName},compareAttributes:function(a,b){return this.compareAttributesWithOther(a,b)&&this.compareAttributesWithOther(b,a)},compareAttributesWithOther:function(a,b){var c,d,e,f,g;for(g=a.attributes,e=0,f=g.length;f>e;e++){if(c=g[e],d=b.getAttribute(c.name),!this.compareAttributeValue(c.name,c.value,d))return!1;if(this.isEmptyAttributeValue(c.value)&&this.emptyAttributeCounts(c.name)&&!b.hasAttribute(c.name))return!1}return!0},emptyAttributeCounts:function(a){switch(a){case"class":case"style":return!1;default:return!0}},compareAttributeValue:function(a,b,c){var d,e,f,g;if(this.isEmptyAttributeValue(b)&&this.isEmptyAttributeValue(c))return!0;if(this.isEmptyAttributeValue(b)||this.isEmptyAttributeValue(c))return!1;switch(a){case"class":return e=b.split(" ").sort(),g=c.split(" ").sort(),e.join(" ")===g.join(" ");case"style":return d=this.prepareStyleValue(b),f=this.prepareStyleValue(c),d===f;default:return b===c}},isEmptyAttributeValue:function(a){return null==a||""===a},prepareStyleValue:function(a){return a=$.trim(a).replace(/\s*:\s*/g,":").replace(/\s*;\s*/g,";").replace(/;$/g,""),a.split(";").sort().join(";")},isEmptyTextNode:function(a){return this.empty.test(a.nodeValue)},isComparable:function(a){var b;return b=a.nodeType,1===b||3===b&&!this.isEmptyTextNode(a)?!0:void 0},iterateComparables:function(a){var b,c=this;return b=this.iterate(a),function(){for(var a;a=b();)if(c.isComparable(a))return a}},iterate:function(a){var b,c;return b=c=a,function(){var d,e;if(e=b=c,d=c=void 0,b)if(d=e.firstChild)c=d;else for(;e!==a&&!(c=e.nextSibling);)e=e.parentNode;return b}}}}(),jQuery.fn.outerHtml=jQuery.fn.outerHtml||function(){var a,b,c;if(a=this[0]){if("undefined"!=typeof a.outerHTML)return a.outerHTML;try{return(new XMLSerializer).serializeToString(a)}catch(d){b=d;try{return a.xml}catch(d){c=d}}}},jQuery.fn.replaceClass=function(a,b){return this.removeClass(a),this.addClass(b)},jQuery.fn.findIn=function(a){return this.find(a).add(this.filter(a))},G=function(){return{isEmpty:function(a){var b;if(null==a)return!0;for(b in a)if(a.hasOwnProperty(b))return!1;return!0},flatCopy:function(a){var b,c,d;b=void 0;for(c in a)d=a[c],b||(b={}),b[c]=d;return b},deepEquals:function(a,b){return JSON.stringify(a)===JSON.stringify(b)}}}(),k=function(){function a(a,b){this.key=a,this.limit=b,this.limit||(this.limit=10),this.index=void 0}return a.prototype.push=function(a){var b,c,d;for(c={key:this.nextKey(),date:Date.now()},b=this.getIndex(),b.push(c);b.length>this.limit;)d=b[0],b.splice(0,1),I.remove(d.key);return I.set(c.key,a),I.set(""+this.key+"--index",b)},a.prototype.pop=function(){var a,b,c;return a=this.getIndex(),a&&a.length?(b=a.pop(),c=I.get(b.key),I.remove(b.key),this.setIndex(),c):void 0},a.prototype.get=function(a){var b,c,d;return b=this.getIndex(),b&&b.length?(a||(a=b.length-1),c=b[a],d=I.get(c.key)):void 0},a.prototype.clear=function(){var a,b;for(a=this.getIndex();b=a.pop();)I.remove(b.key);return this.setIndex()},a.prototype.getIndex=function(){return this.index||(this.index=I.get(""+this.key+"--index")||[]),this.index},a.prototype.setIndex=function(){return this.index?I.set(""+this.key+"--index",this.index):void 0},a.prototype.nextKey=function(){var a;return a=Math.floor(1e16*Math.random()).toString(32),""+this.key+"-"+a},a}(),I=function(){var a;return a=jQuery,{set:function(a,b){return store.set(a,b)},get:function(a){return store.get(a)},remove:function(a){return store.remove(a)},clear:function(){return store.clear()},disbled:function(){return store.disabled}}}(),J=function(){var a;return a=1<=arguments.length?O.call(arguments,0):[],null!=window.console?(a.length&&"trace"===a[a.length-1]&&(a.pop(),null!=window.console.trace&&window.console.trace()),window.console.log.apply(window.console,a),void 0):void 0},function(){var a,b;return a=function(a){function b(a){b.__super__.constructor.apply(this,arguments),this.message=a,this.thrownByLivingdocs=!0}return Q(b,a),b}(Error),b=function(b,c){if(null==c&&(c="error"),"undefined"!=typeof _rollbar&&null!==_rollbar)_rollbar.push(new Error(b),function(){var a;return"critical"!==c&&"error"!==c||null==(null!=(a=window.console)?a.error:void 0)?J.call(void 0,b):window.console.error.call(window.console,b)});else{if("critical"===c||"error"===c)throw new a(b);J.call(void 0,b)}return void 0},J.debug=function(a){return J.debugDisabled?void 0:b(a,"debug")},J.warn=function(a){return J.warningsDisabled?void 0:b(a,"warning")},J.error=function(a){return b(a,"error")}}(),K=function(){var a,b,c,d,e,f;for(d=1<=arguments.length?O.call(arguments,0):[],a=function(){},f=d.length-1;f>=0;f+=-1){c=d[f];for(e in c)b=c[e],a.prototype[e]=b}return a},o=function(){function a(){this.count=0,this.started=!1,this.wasFired=!1,this.callbacks=[]}return a.prototype.addCallback=function(a){return this.wasFired?a():this.callbacks.push(a)},a.prototype.isReady=function(){return this.wasFired},a.prototype.start=function(){return w(!this.started,"Unable to start Semaphore once started."),this.started=!0,this.fireIfReady()},a.prototype.increment=function(){return w(!this.wasFired,"Unable to increment count once Semaphore is fired."),this.count+=1},a.prototype.decrement=function(){return w(this.count>0,"Unable to decrement count resulting in negative count."),this.count-=1,this.fireIfReady()},a.prototype.wait=function(){var a=this;return this.increment(),function(){return a.decrement()}},a.prototype.fireIfReady=function(){var a,b,c,d,e;if(0===this.count&&this.started===!0){for(this.wasFired=!0,d=this.callbacks,e=[],b=0,c=d.length;c>b;b++)a=d[b],e.push(a());return e}},a}(),N=function(){var a;return a=!1,{init:function(){return a?void 0:(a=!0,this.store=new k("stash",10))},snapshot:function(){return this.store.push(B.toJson())},stash:function(){return this.snapshot(),B.reset()},clear:function(){return this.store.clear()},"delete":function(){return this.store.pop()},get:function(){return this.store.get()},restore:function(){var a;return a=this.store.get(),w(a,"stash is empty"),B.restore(a)},list:function(){var a,b;return a=function(){var a,c,d,e;for(d=this.store.getIndex(),e=[],a=0,c=d.length;c>a;a++)b=d[a],e.push({key:b.key,date:new Date(b.date).toString()});return e}.call(this),words.readableJson(a)}}}(),this.words=function(){return{humanize:function(a){var b;return b=$.trim(a).replace(/([a-z\d])([A-Z]+)/g,"$1 $2").toLowerCase(),this.titleize(b)},capitalize:function(a){return a=null==a?"":String(a),a.charAt(0).toUpperCase()+a.slice(1)},titleize:function(a){return null==a?"":String(a).replace(/(?:^|\s)\S/g,function(a){return a.toUpperCase()})},snakeCase:function(a){return $.trim(a).replace(/([A-Z])/g,"-$1").replace(/[-_\s]+/g,"-").toLowerCase()},prefix:function(a,b){return 0===b.indexOf(a)?b:""+a+b},readableJson:function(a){return JSON.stringify(a,null,2)},camelize:function(a){return $.trim(a).replace(/[-_\s]+(.)?/g,function(a,b){return b.toUpperCase()})},trim:function(a){return a.replace(/^\s+|\s+$/g,"")}}}(),n=function(){function a(){this.renderNode=$("<div/>")[0],this.readySemaphore=new o,this.beforeReady(),this.readySemaphore.start()}return a.prototype.isReadOnly=!0,a.prototype.html=function(){return $(this.renderNode).html()},a.prototype.snippetViewWasInserted=function(){},a.prototype.beforeReady=function(){},a.prototype.ready=function(a){return this.readySemaphore.addCallback(a)},a}(),l=function(b){function c(a){var b,d,e,f;f=null!=a?a:{},e=f.renderNode,d=f.readOnly,b=f.hostWindow,this.design=f.design,null!=d&&(this.isReadOnly=d),this.setWindow(b),c.__super__.constructor.call(this),e=e||$("."+docClass.section,this.$body),this.renderNode=e.jquery?e[0]:e}return Q(c,b),c.prototype.beforeReady=function(){var b;return this.cssLoader=new a(this.window),(null!=(b=this.design)?b.css:void 0)?this.cssLoader.load(this.design.css,this.readySemaphore.wait()):void 0},c.prototype.setWindow=function(a){return this.window=a||window,this.document=this.window.document,this.$document=$(this.document),this.$body=$(this.document.body)},c}(n),j=function(a){function b(a){var c,d,e;e=null!=a?a:{},d=e.renderNode,c=e.hostWindow,b.__super__.constructor.apply(this,arguments),this.focus=new i,this.editableController=new h(this),this.imageClick=$.Callbacks(),this.htmlElementClick=$.Callbacks(),this.snippetWillBeDragged=$.Callbacks(),this.snippetWasDropped=$.Callbacks(),this.snippetDragDrop=new g({longpressDelay:400,longpressDistanceLimit:10,preventDefault:!1}),this.focus.snippetFocus.add($.proxy(this.afterSnippetFocused,this)),this.focus.snippetBlur.add($.proxy(this.afterSnippetBlurred,this)),this.$document.on("click.livingdocs",$.proxy(this.click,this)).on("mousedown.livingdocs",$.proxy(this.mousedown,this)).on("touchstart.livingdocs",$.proxy(this.mousedown,this)).on("dragstart",$.proxy(this.browserDragStart,this))}var c;return Q(b,a),c=1,b.prototype.isReadOnly=!1,b.prototype.browserDragStart=function(a){return a.preventDefault(),a.stopPropagation()},b.prototype.removeListeners=function(){return this.$document.off(".livingdocs"),this.$document.off(".livingdocs-drag")},b.prototype.mousedown=function(a){var b;if(a.which===c||"mousedown"!==a.type)return b=C.findSnippetView(a.target),b?this.startDrag({snippetView:b,dragDrop:this.snippetDragDrop,event:a}):void 0},b.prototype.registerDragStopEvents=function(a,b){var c,d=this;return c="touchstart"===b.type?"touchend.livingdocs-drag touchcancel.livingdocs-drag touchleave.livingdocs-drag":"mouseup.livingdocs-drag",this.$document.on(c,function(){return a.drop(),d.$document.off(".livingdocs-drag")})},b.prototype.registerDragMoveEvents=function(a,b){return"touchstart"===b.type?this.$document.on("touchmove.livingdocs-drag",function(b){return b.preventDefault(),a.move(b.originalEvent.changedTouches[0].pageX,b.originalEvent.changedTouches[0].pageY,b)}):this.$document.on("mousemove.livingdocs-drag",function(b){return a.move(b.pageX,b.pageY,b)})},b.prototype.startDrag=function(a){var b,c,d,e,f,g;return e=a.snippet,g=a.snippetView,c=a.dragDrop,d=a.event,e||g?(g&&(e=g.model),this.registerDragMoveEvents(c,d),this.registerDragStopEvents(c,d),f=new r({snippet:e,page:this}),g&&(b=g.$html),c.mousedown(b,d,{onDragStart:f.onStart,onDrag:f.onDrag,onDrop:f.onDrop})):void 0},b.prototype.click=function(a){var b,c;if(c=C.findSnippetView(a.target),b=C.findNodeContext(a.target),!c)return this.focus.blur();if(this.focus.snippetFocused(c),b)switch(b.contextAttr){case config.directives.image.renderedAttr:return this.imageClick.fire(c,b.attrName,a);case config.directives.html.renderedAttr:return this.htmlElementClick.fire(c,b.attrName,a)}},b.prototype.getFocusedElement=function(){return window.document.activeElement},b.prototype.blurFocusedElement=function(){var a;return this.focus.setFocus(void 0),a=this.getFocusedElement(),a?$(a).blur():void 0},b.prototype.snippetViewWasInserted=function(a){return this.initializeEditables(a)},b.prototype.initializeEditables=function(a){var b,c;return a.directives.editable?(c=function(){var c,d,e,f;for(e=a.directives.editable,f=[],c=0,d=e.length;d>c;c++)b=e[c],f.push(b.elem);return f}(),this.editableController.add(c)):void 0},b.prototype.afterSnippetFocused=function(a){return a.afterFocused()},b.prototype.afterSnippetBlurred=function(a){return a.afterBlurred()},b}(l),p=function(){function a(a){this.snippets=a,null==this.snippets&&(this.snippets=[]),this.createPseudoArray()}return a.prototype.createPseudoArray=function(){var a,b,c,d,e;for(e=this.snippets,a=c=0,d=e.length;d>c;a=++c)b=e[a],this[a]=b;return this.length=this.snippets.length,this.snippets.length?(this.first=this[0],this.last=this[this.snippets.length-1]):void 0},a.prototype.each=function(a){var b,c,d,e;for(e=this.snippets,c=0,d=e.length;d>c;c++)b=e[c],a(b);return this},a.prototype.remove=function(){return this.each(function(a){return a.remove()}),this},a}(),q=function(){function a(a){var b;this.parentSnippet=a.parentSnippet,this.name=a.name,b=a.isRoot,this.isRoot=null!=b,this.first=this.last=void 0}return a.prototype.prepend=function(a){return this.first?this.insertBefore(this.first,a):this.attachSnippet(a),this},a.prototype.append=function(a){return this.parentSnippet&&w(a!==this.parentSnippet,"cannot append snippet to itself"),this.last?this.insertAfter(this.last,a):this.attachSnippet(a),this},a.prototype.insertBefore=function(a,b){var c;if(a.previous!==b)return w(a!==b,"cannot insert snippet before itself"),c={previous:a.previous,next:a,parentContainer:a.parentContainer},this.attachSnippet(b,c)},a.prototype.insertAfter=function(a,b){var c;if(a.next!==b)return w(a!==b,"cannot insert snippet after itself"),c={previous:a,next:a.next,parentContainer:a.parentContainer},this.attachSnippet(b,c)},a.prototype.up=function(a){return null!=a.previous?this.insertBefore(a.previous,a):void 0},a.prototype.down=function(a){return null!=a.next?this.insertAfter(a.next,a):void 0},a.prototype.getSnippetTree=function(){var a;return this.snippetTree||(null!=(a=this.parentSnippet)?a.snippetTree:void 0)},a.prototype.each=function(a){var b,c;for(b=this.first,c=[];b;)b.descendantsAndSelf(a),c.push(b=b.next);return c},a.prototype.eachContainer=function(a){return a(this),this.each(function(b){var c,d,e,f;e=b.containers,f=[];for(c in e)d=e[c],f.push(a(d));return f})},a.prototype.all=function(a){return a(this),this.each(function(b){var c,d,e,f;a(b),e=b.containers,f=[];for(c in e)d=e[c],f.push(a(d));return f})},a.prototype.remove=function(a){return a.destroy(),this._detachSnippet(a)},a.prototype.ui=function(){var a;return this.uiInjector||(a=this.getSnippetTree(),a.renderer.createInterfaceInjector(this)),this.uiInjector},a.prototype.attachSnippet=function(a,b){var c,d,e=this;return null==b&&(b={}),c=function(){return e.link(a,b)},(d=this.getSnippetTree())?d.attachingSnippet(a,c):c()},a.prototype._detachSnippet=function(a){var b,c,d=this;return b=function(){return d.unlink(a)},(c=this.getSnippetTree())?c.detachingSnippet(a,b):b()},a.prototype.link=function(a,b){return a.parentContainer&&this.unlink(a),b.parentContainer||(b.parentContainer=this),this.setSnippetPosition(a,b)},a.prototype.unlink=function(a){var b,c,d;return b=a.parentContainer,b?(null==a.previous&&(b.first=a.next),null==a.next&&(b.last=a.previous),null!=(c=a.next)&&(c.previous=a.previous),null!=(d=a.previous)&&(d.next=a.next),this.setSnippetPosition(a,{})):void 0},a.prototype.setSnippetPosition=function(a,b){var c,d,e;return d=b.parentContainer,e=b.previous,c=b.next,a.parentContainer=d,a.previous=e,a.next=c,d&&(e&&(e.next=a),c&&(c.previous=a),null==a.previous&&(d.first=a),null==a.next)?d.last=a:void 0},a}(),s=function(){function a(a){var b,c;c=null!=a?a:{},this.template=c.template,b=c.id,w(this.template,"cannot instantiate snippet without template reference"),this.initializeDirectives(),this.styles={},this.dataValues={},this.id=b||E.next(),this.identifier=this.template.identifier,this.next=void 0,this.previous=void 0,this.snippetTree=void 0}return a.prototype.initializeDirectives=function(){var a,b,c,d,e;for(d=this.template.directives,e=[],b=0,c=d.length;c>b;b++)switch(a=d[b],a.type){case"container":this.containers||(this.containers={}),e.push(this.containers[a.name]=new q({name:a.name,parentSnippet:this}));break;case"editable":case"image":case"html":this.content||(this.content={}),e.push(this.content[a.name]=void 0);break;default:e.push(J.error("Template directive type '"+a.type+"' not implemented in SnippetModel"))}return e},a.prototype.createView=function(a){return this.template.createView(this,a)},a.prototype.hasContainers=function(){return this.template.directives.count("container")>0},a.prototype.hasEditables=function(){return this.template.directives.count("editable")>0},a.prototype.hasHtml=function(){return this.template.directives.count("html")>0},a.prototype.hasImages=function(){return this.template.directives.count("image")>0},a.prototype.before=function(a){return a?(this.parentContainer.insertBefore(this,a),this):this.previous},a.prototype.after=function(a){return a?(this.parentContainer.insertAfter(this,a),this):this.next},a.prototype.append=function(a,b){return 1===arguments.length&&(b=a,a=config.directives.container.defaultName),this.containers[a].append(b),this},a.prototype.prepend=function(a,b){return 1===arguments.length&&(b=a,a=config.directives.container.defaultName),this.containers[a].prepend(b),this},a.prototype.set=function(a,b){var c;return w(null!=(c=this.content)?c.hasOwnProperty(a):void 0,"set error: "+this.identifier+" has no content named "+a),this.content[a]!==b&&(this.content[a]=b,this.snippetTree)?this.snippetTree.contentChanging(this,a):void 0},a.prototype.get=function(a){var b;return w(null!=(b=this.content)?b.hasOwnProperty(a):void 0,"get error: "+this.identifier+" has no content named "+a),this.content[a]},a.prototype.data=function(a){var b,c,d;if("object"!=typeof a)return this.dataValues[a];b=[];for(c in a)d=a[c],this.changeData(c,d)&&b.push(c);return this.snippetTree&&b.length>0?this.snippetTree.dataChanging(this,b):void 0},a.prototype.changeData=function(a,b){return G.deepEquals(this.dataValues[a],b)?!1:(this.dataValues[a]=b,!0)},a.prototype.isEmpty=function(a){var b;return b=this.get(a),void 0===b||""===b},a.prototype.style=function(a,b){return 1===arguments.length?this.styles[a]:this.setStyle(a,b)},a.prototype.setStyle=function(a,b){var c;return c=this.template.styles[a],c?c.validateValue(b)?this.styles[a]!==b&&(this.styles[a]=b,this.snippetTree)?this.snippetTree.htmlChanging(this,"style",{name:a,value:b}):void 0:J.warn("Invalid value '"+b+"' for style '"+a+"' in SnippetModel "+this.identifier):J.warn("Unknown style '"+a+"' in SnippetModel "+this.identifier)},a.prototype.copy=function(b){var c;return c=this.toJson(),c.id=E.next(),a.fromJson(c,b)},a.prototype.copyWithoutContent=function(){return this.template.createModel()},a.prototype.up=function(){return this.parentContainer.up(this),this},a.prototype.down=function(){return this.parentContainer.down(this),this},a.prototype.remove=function(){return this.parentContainer.remove(this)},a.prototype.destroy=function(){return this.uiInjector?this.uiInjector.remove():void 0},a.prototype.getParent=function(){var a;return null!=(a=this.parentContainer)?a.parentSnippet:void 0},a.prototype.ui=function(){return this.uiInjector||this.snippetTree.renderer.createInterfaceInjector(this),this.uiInjector},a.prototype.parents=function(a){var b,c;for(b=this,c=[];b=b.getParent();)c.push(a(b));return c},a.prototype.children=function(a){var b,c,d,e,f;e=this.containers,f=[];for(b in e)c=e[b],d=c.first,f.push(function(){var b;for(b=[];d;)a(d),b.push(d=d.next);return b}());return f},a.prototype.descendants=function(a){var b,c,d,e,f;e=this.containers,f=[];for(b in e)c=e[b],d=c.first,f.push(function(){var b;for(b=[];d;)a(d),d.descendants(a),b.push(d=d.next);return b}());return f},a.prototype.descendantsAndSelf=function(a){return a(this),this.descendants(a)},a.prototype.descendantContainers=function(a){return this.descendantsAndSelf(function(b){var c,d,e,f;e=b.containers,f=[];for(c in e)d=e[c],f.push(a(d));return f})},a.prototype.allDescendants=function(a){var b=this;return this.descendantsAndSelf(function(c){var d,e,f,g;c!==b&&a(c),f=c.containers,g=[];for(d in f)e=f[d],g.push(a(e));return g})},a.prototype.childrenAndSelf=function(a){return a(this),this.children(a)},a.prototype.toJson=function(){var a,b;a={id:this.id,identifier:this.identifier},G.isEmpty(this.content)||(a.content=G.flatCopy(this.content)),G.isEmpty(this.styles)||(a.styles=G.flatCopy(this.styles)),G.isEmpty(this.dataValues)||(a.data=$.extend(!0,{},this.dataValues));for(b in this.containers)a.containers||(a.containers={}),a.containers[b]=[];return a},a}(),s.fromJson=function(a,b){var c,d,e,f,g,h,i,j,k,l,m,n,o;i=b.get(a.identifier),w(i,"error while deserializing snippet: unknown template identifier '"+a.identifier+"'"),e=new s({template:i,id:a.id}),m=a.content;for(f in m)j=m[f],w(e.content.hasOwnProperty(f),"error while deserializing snippet: unknown content '"+f+"'"),e.content[f]=j;n=a.styles;for(h in n)j=n[h],e.style(h,j);a.data&&e.data(a.data),o=a.containers;for(d in o)if(g=o[d],w(e.containers.hasOwnProperty(d),"error while deserializing snippet: unknown container "+d),g)for(w($.isArray(g),"error while deserializing snippet: container is not array "+d),k=0,l=g.length;l>k;k++)c=g[k],e.append(d,s.fromJson(c,b));return e},t=function(){function a(a){var b,c,d;d=null!=a?a:{},b=d.content,c=d.design,this.root=new q({isRoot:!0}),null!=b&&null!=c&&this.fromJson(b,c),this.root.snippetTree=this,this.initializeEvents()}return a.prototype.prepend=function(a){return this.root.prepend(a),this},a.prototype.append=function(a){return this.root.append(a),this},a.prototype.initializeEvents=function(){return this.snippetAdded=$.Callbacks(),this.snippetRemoved=$.Callbacks(),this.snippetMoved=$.Callbacks(),this.snippetContentChanged=$.Callbacks(),this.snippetHtmlChanged=$.Callbacks(),this.snippetDataChanged=$.Callbacks(),this.snippetSettingsChanged=$.Callbacks(),this.changed=$.Callbacks()},a.prototype.each=function(a){return this.root.each(a)},a.prototype.eachContainer=function(a){return this.root.eachContainer(a)},a.prototype.all=function(a){return this.root.all(a)},a.prototype.find=function(a){var b;return"string"==typeof a?(b=[],this.each(function(c){return c.identifier===a||c.template.id===a?b.push(c):void 0}),new p(b)):new p},a.prototype.detach=function(){var a;return this.root.snippetTree=void 0,this.each(function(a){return a.snippetTree=void 0}),a=this.root,this.root=new q({isRoot:!0}),a},a.prototype.print=function(){var a,b,c;return b="SnippetTree\n-----------\n",a=function(a,c){return null==c&&(c=0),b+=""+Array(c+1).join(" ")+a+"\n"},c=function(b,d){var e,f,g,h;null==d&&(d=0),g=b.template,a("- "+g.title+" ("+g.identifier+")",d),h=b.containers;for(e in h)f=h[e],a(""+e+":",d+2),f.first&&c(f.first,d+4);return b.next?c(b.next,d):void 0},this.root.first&&c(this.root.first),b},a.prototype.attachingSnippet=function(a,b){var c=this;return a.snippetTree===this?(b(),this.fireEvent("snippetMoved",a)):(null!=a.snippetTree&&a.snippetContainer.detachSnippet(a),a.descendantsAndSelf(function(a){return a.snippetTree=c}),b(),this.fireEvent("snippetAdded",a))},a.prototype.fireEvent=function(){var a,b;return b=arguments[0],a=2<=arguments.length?O.call(arguments,1):[],this[b].fire.apply(b,a),this.changed.fire()},a.prototype.detachingSnippet=function(a,b){return w(a.snippetTree===this,"cannot remove snippet from another SnippetTree"),a.descendantsAndSelf(function(a){return a.snippetTree=void 0}),b(),this.fireEvent("snippetRemoved",a)},a.prototype.contentChanging=function(a){return this.fireEvent("snippetContentChanged",a)},a.prototype.htmlChanging=function(a){return this.fireEvent("snippetHtmlChanged",a)},a.prototype.dataChanging=function(a,b){return this.fireEvent("snippetDataChanged",a,b)},a.prototype.printJson=function(){return words.readableJson(this.toJson())},a.prototype.toJson=function(){var a,b,c;return a={},a.content=[],b=function(a,b,c){var d;return d=a.toJson(),c.push(d),d},c=function(a,d,e){var f,g,h,i,j;i=b(a,d,e),j=a.containers;for(g in j)h=j[g],f=i.containers[h.name]=[],h.first&&c(h.first,d+1,f);return a.next?c(a.next,d,e):void 0},this.root.first&&c(this.root.first,0,a.content),a},a.prototype.fromJson=function(a,b){var c,d,e,f,g,h=this;if(this.root.snippetTree=void 0,a.content)for(g=a.content,e=0,f=g.length;f>e;e++)d=g[e],c=s.fromJson(d,b),this.root.append(c);return this.root.snippetTree=this,this.root.each(function(a){return a.snippetTree=h})},a}(),d=function(){function a(a){var b;b=a.name,this.type=a.type,this.elem=a.elem,this.name=b||config.directives[this.type].defaultName,this.config=config.directives[this.type],this.optional=!1}return a.prototype.renderedAttr=function(){return this.config.renderedAttr},a.prototype.isElementDirective=function(){return this.config.elementDirective},a.prototype.clone=function(){var b;return b=new a({name:this.name,type:this.type}),b.optional=this.optional,b},a}(),e=function(){function a(a){this.all=null!=a?a:{},this.length=0}return a.prototype.add=function(a){var b;return this.assertNameNotUsed(a),this[this.length]=a,a.index=this.length,this.length+=1,this.all[a.name]=a,this[b=a.type]||(this[b]=[]),this[a.type].push(a)},a.prototype.next=function(a){var b;return a instanceof d&&(b=a),b||(b=this.all[a]),this[b.index+=1]},a.prototype.nextOfType=function(a){var b,c;for(a instanceof d&&(b=a),b||(b=this.all[a]),c=b.type;b=this.next(b);)if(b.type===c)return b},a.prototype.get=function(a){return this.all[a]},a.prototype.$getElem=function(a){return $(this.all[a].elem)},a.prototype.count=function(a){var b;return a?null!=(b=this[a])?b.length:void 0:this.length},a.prototype.each=function(a){var b,c,d,e;for(e=[],c=0,d=this.length;d>c;c++)b=this[c],e.push(a(b));return e},a.prototype.clone=function(){var b;return b=new a,this.each(function(a){return b.add(a.clone())}),b},a.prototype.assertAllLinked=function(){return this.each(function(a){return a.elem?void 0:!1}),!0},a.prototype.assertNameNotUsed=function(a){return w(a&&!this.all[a.name],""+a.type+" Template parsing error:\n"+config.directives[a.type].renderedAttr+'="'+a.name+'".\n"'+a.name+'" is a duplicate name.')},a}(),z=function(){var a;return a=/^(x-|data-)/,{parse:function(a){var b,c;return b=void 0,c=[],this.parseDirectives(a,function(a){return a.isElementDirective()?b=a:c.push(a)}),b&&this.applyModifications(b,c),b},parseDirectives:function(b,c){var e,f,g,h,i,j,k,l,m,n,o,p,q;for(i=[],p=b.attributes,l=0,n=p.length;n>l;l++)e=p[l],f=e.name,j=f.replace(a,""),(k=templateAttrLookup[j])&&i.push({attributeName:f,directive:new d({name:e.value,type:k,elem:b})});for(q=[],m=0,o=i.length;o>m;m++)g=i[m],h=g.directive,this.rewriteAttribute(h,g.attributeName),q.push(c(h));return q},applyModifications:function(a,b){var c,d,e,f;for(f=[],d=0,e=b.length;e>d;d++)switch(c=b[d],c.type){case"optional":f.push(a.optional=!0);break;default:f.push(void 0)}return f},rewriteAttribute:function(a,b){return a.isElementDirective()?b!==a.renderedAttr()?this.normalizeAttribute(a,b):a.name?void 0:this.normalizeAttribute(a):this.removeAttribute(a,b)},normalizeAttribute:function(a,b){var c;return c=a.elem,b&&this.removeAttribute(a,b),c.setAttribute(a.renderedAttr(),a.name)},removeAttribute:function(a,b){return a.elem.removeAttribute(b)}}}(),A=function(){var a;return a=/^(x-|data-)/,{link:function(b,c){var d,e,f,g,h,i,j;for(j=b.attributes,h=0,i=j.length;i>h;h++)d=j[h],f=d.name.replace(a,""),(g=templateAttrLookup[f])&&(e=c.get(d.value),e.elem=b);return void 0}}}(),f=function(){function a(a){this.root=this._next=a,this.containerAttr=config.directives.container.renderedAttr}return a.prototype.current=null,a.prototype.hasNext=function(){return!!this._next},a.prototype.next=function(){var a,b,c;if(b=this.current=this._next,a=c=void 0,this.current)if(a=b.firstChild,a&&1===b.nodeType&&!b.hasAttribute(this.containerAttr))this._next=a;else{for(c=null;b!==this.root&&!(c=b.nextSibling);)b=b.parentNode;this._next=c}return this.current},a.prototype.nextElement=function(){for(;this.next()&&1!==this.current.nodeType;);return this.current},a.prototype.detach=function(){return this.current=this._next=this.root=null},a}(),v=function(){function a(b){var c,d,e,f,g,h,i;h=null!=b?b:{},c=h.html,this.namespace=h.namespace,this.id=h.id,d=h.identifier,f=h.title,e=h.styles,g=h.weight,w(c,"Template: param html missing"),d&&(i=a.parseIdentifier(d),this.namespace=i.namespace,this.id=i.id),this.identifier=this.namespace&&this.id?""+this.namespace+"."+this.id:void 0,this.$template=$(this.pruneHtml(c)).wrap("<div>"),this.$wrap=this.$template.parent(),this.title=f||words.humanize(this.id),this.styles=e||{},this.weight=g,this.defaults={},this.parseTemplate()}return a.prototype.createModel=function(){return new s({template:this})},a.prototype.createView=function(a,b){var c,d,e;return a||(a=this.createModel()),c=this.$template.clone(),d=this.linkDirectives(c[0]),e=new u({model:a,$html:c,directives:d,isReadOnly:b})},a.prototype.pruneHtml=function(a){return a=$(a).filter(function(){return 8!==this.nodeType}),w(1===a.length,'Templates must contain one root element. The Template "'+this.identifier+'" contains '+a.length),a},a.prototype.parseTemplate=function(){var a,b=this;return a=this.$template[0],this.directives=this.compileDirectives(a),this.directives.each(function(a){switch(a.type){case"editable":return b.formatEditable(a.name,a.elem);case"container":return b.formatContainer(a.name,a.elem);case"html":return b.formatHtml(a.name,a.elem)}})},a.prototype.compileDirectives=function(a){var b,c,d;
for(d=new f(a),c=new e;a=d.nextElement();)b=z.parse(a),b&&c.add(b);return c},a.prototype.linkDirectives=function(a){var b,c;for(b=new f(a),c=this.directives.clone();a=b.nextElement();)A.link(a,c);return c},a.prototype.formatEditable=function(a,b){var c,d;return c=$(b),c.addClass(docClass.editable),d=words.trim(b.innerHTML),d&&(this.defaults[a]=d),b.innerHTML=""},a.prototype.formatContainer=function(a,b){return b.innerHTML=""},a.prototype.formatHtml=function(a,b){var c;return c=words.trim(b.innerHTML),c&&(this.defaults[a]=c),b.innerHTML=""},a.prototype.printDoc=function(){var a;return a={identifier:this.identifier},words.readableJson(a)},a}(),v.parseIdentifier=function(a){var b;if(a)return b=a.split("."),1===b.length?{namespace:void 0,id:b[0]}:2===b.length?{namespace:b[0],id:b[1]}:J.error("could not parse snippet template identifier: "+a)},a=function(){function a(a){this.window=a,this.loadedUrls=[]}return a.prototype.load=function(a,b){var c,d,e,f;for(null==b&&(b=$.noop),$.isArray(a)||(a=[a]),c=new o,c.addCallback(b),e=0,f=a.length;f>e;e++)d=a[e],this.loadSingleUrl(d,c.wait());return c.start()},a.prototype.loadSingleUrl=function(a,b){var c;return null==b&&(b=$.noop),this.isUrlLoaded(a)?b():(c=$('<link rel="stylesheet" type="text/css" />')[0],c.onload=b,c.href=a,this.window.document.head.appendChild(c),this.markUrlAsLoaded(a))},a.prototype.isUrlLoaded=function(a){return this.loadedUrls.indexOf(a)>=0},a.prototype.markUrlAsLoaded=function(a){return this.loadedUrls.push(a)},a}(),b=function(){function a(a){var b,c,d;d=a.templates||a.snippets,b=a.config,c=a.config.groups||a.groups,this.namespace=(null!=b?b.namespace:void 0)||"livingdocs-templates",this.css=b.css,this.js=b.js,this.fonts=b.fonts,this.templates=[],this.groups={},this.styles={},this.storeTemplateDefinitions(d),this.globalStyles=this.createDesignStyleCollection(a.config.styles),this.addGroups(c),this.addTemplatesNotInGroups()}return a.prototype.storeTemplateDefinitions=function(a){var b,c,d,e;for(this.templateDefinitions={},e=[],c=0,d=a.length;d>c;c++)b=a[c],e.push(this.templateDefinitions[b.id]=b);return e},a.prototype.add=function(a,b){var c,d,e;return this.templateDefinitions[a.id]=void 0,d=this.createDesignStyleCollection(a.styles),e=$.extend({},b,d),c=new v({namespace:this.namespace,id:a.id,title:a.title,styles:e,html:a.html,weight:a.sortOrder||0}),this.templates.push(c),c},a.prototype.addGroups=function(a){var b,c,d,e,f,g,h,i,j,k,l,m;m=[];for(c in a){for(b=a[c],d=this.createDesignStyleCollection(b.styles),e=$.extend({},this.globalStyles,d),i={},l=b.templates,j=0,k=l.length;k>j;j++)h=l[j],g=this.templateDefinitions[h],g?(f=this.add(g,e),i[f.id]=f):J.warn("The template '"+h+"' referenced in the group '"+c+"' does not exist.");m.push(this.addGroup(c,b,i))}return m},a.prototype.addTemplatesNotInGroups=function(){var a,b,c,d;c=this.templateDefinitions,d=[];for(b in c)a=c[b],a?d.push(this.add(a,this.globalStyles)):d.push(void 0);return d},a.prototype.addGroup=function(a,b,c){return this.groups[a]={title:b.title,templates:c}},a.prototype.createDesignStyleCollection=function(a){var b,c,d,e,f;if(c={},a)for(e=0,f=a.length;f>e;e++)d=a[e],b=this.createDesignStyle(d),b&&(c[b.name]=b);return c},a.prototype.createDesignStyle=function(a){return a&&a.name?new c({name:a.name,type:a.type,options:a.options,value:a.value}):void 0},a.prototype.remove=function(a){var b=this;return this.checkNamespace(a,function(a){return b.templates.splice(b.getIndex(a),1)})},a.prototype.get=function(a){var b=this;return this.checkNamespace(a,function(a){var c;return c=void 0,b.each(function(b){return b.id===a?c=b:void 0}),c})},a.prototype.getIndex=function(a){var b=this;return this.checkNamespace(a,function(a){var c;return c=void 0,b.each(function(b,d){return b.id===a?c=d:void 0}),c})},a.prototype.checkNamespace=function(a,b){var c,d,e;return e=v.parseIdentifier(a),d=e.namespace,c=e.id,w(!d||this.namespace===d,"design "+this.namespace+": cannot get template with different namespace "+d+" "),b(c)},a.prototype.each=function(a){var b,c,d,e,f,g;for(f=this.templates,g=[],b=d=0,e=f.length;e>d;b=++d)c=f[b],g.push(a(c,b));return g},a.prototype.list=function(){var a;return a=[],this.each(function(b){return a.push(b.identifier)}),a},a.prototype.info=function(a){var b;return b=this.get(a),b.printDoc()},a}(),c=function(){function a(a){var b,c;switch(this.name=a.name,this.type=a.type,c=a.value,b=a.options,this.type){case"option":w(c,"TemplateStyle error: no 'value' provided"),this.value=c;break;case"select":w(b,"TemplateStyle error: no 'options' provided"),this.options=b;break;default:J.error("TemplateStyle error: unknown type '"+this.type+"'")}}return a.prototype.cssClassChanges=function(a){if(this.validateValue(a)){if("option"===this.type)return{remove:a?void 0:[this.value],add:a};if("select"===this.type)return{remove:this.otherClasses(a),add:a}}else{if("option"===this.type)return{remove:currentValue,add:void 0};if("select"===this.type)return{remove:this.otherClasses(void 0),add:void 0}}},a.prototype.validateValue=function(a){return a?"option"===this.type?a===this.value:"select"===this.type?this.containsOption(a):J.warn("Not implemented: DesignStyle#validateValue() for type "+this.type):!0},a.prototype.containsOption=function(a){var b,c,d,e;for(e=this.options,c=0,d=e.length;d>c;c++)if(b=e[c],a===b.value)return!0;return!1},a.prototype.otherOptions=function(a){var b,c,d,e,f;for(c=[],f=this.options,d=0,e=f.length;e>d;d++)b=f[d],b.value!==a&&c.push(b);return c},a.prototype.otherClasses=function(a){var b,c,d,e,f;for(c=[],f=this.options,d=0,e=f.length;e>d;d++)b=f[d],b.value!==a&&c.push(b.value);return c},a}(),B=function(){return{initialized:!1,uniqueId:0,ready:$.Callbacks("memory once"),changed:$.Callbacks(),init:function(a){var c,d,e,f,g=this;return f=null!=a?a:{},c=f.design,d=f.json,e=f.rootNode,this.initialized?void 0:(this.initialized=!0,this.design=new b(c),this.snippetTree=d&&this.design?new t({content:d,design:this.design}):new t,this.snippetTree.changed.add(function(){return g.changed.fire()}),this.page=new j({renderNode:e,design:this.design}),this.renderer=new m({snippetTree:this.snippetTree,renderingContainer:this.page}),this.renderer.ready(function(){return g.ready.fire()}))},createView:function(a){var b,c,d,e,f=this;return null==a&&(a=window.document.body),c=function(){var a,b;return a=new l({renderNode:e.contentDocument.body,hostWindow:e.contentWindow,design:f.design}),b=new m({renderingContainer:a,snippetTree:f.snippetTree}),d.resolve({iframe:e,renderer:b})},d=$.Deferred(),b=$(a).first(),e=b[0].ownerDocument.createElement("iframe"),e.src="about:blank",e.onload=c,b.append(e),d.promise()},eachContainer:function(a){return this.snippetTree.eachContainer(a)},add:function(a){var b;return b="string"===jQuery.type(a)?this.createModel(a):a,b&&this.snippetTree.append(b),b},createModel:function(a){var b;return b=this.getTemplate(a),b?b.createModel():void 0},find:function(a){return this.snippetTree.find(a)},printTree:function(){return this.snippetTree.print()},toJson:function(){var a;return a=this.snippetTree.toJson(),a.meta={title:void 0,author:void 0,created:void 0,published:void 0},a},toHtml:function(){return new m({snippetTree:this.snippetTree,renderingContainer:new n}).html()},restore:function(a,b){return null==b&&(b=!0),b&&this.reset(),this.snippetTree.fromJson(a,this.design),this.renderer.render()},reset:function(){return this.renderer.clear(),this.snippetTree.detach()},getTemplate:function(a){var b,c;return b=null!=(c=this.design)?c.get(a):void 0,w(b,"could not find template "+a),b}}}(),C=function(){var a,b;return b=new RegExp("(?: |^)"+docClass.snippet+"(?: |$)"),a=new RegExp("(?: |^)"+docClass.section+"(?: |$)"),{findSnippetView:function(a){var c;for(a=this.getElementNode(a);a&&1===a.nodeType;){if(b.test(a.className))return c=this.getSnippetView(a);a=a.parentNode}return void 0},findNodeContext:function(a){var b;for(a=this.getElementNode(a);a&&1===a.nodeType;){if(b=this.getNodeContext(a))return b;a=a.parentNode}return void 0},getNodeContext:function(a){var b,c,d,e;e=config.directives;for(c in e)if(d=e[c],d.elementDirective&&(b=d.renderedAttr,a.hasAttribute(b)))return{contextAttr:b,attrName:a.getAttribute(b)};return void 0},findContainer:function(b){var c,d,e;for(b=this.getElementNode(b),c=config.directives.container.renderedAttr;b&&1===b.nodeType;){if(b.hasAttribute(c))return d=b.getAttribute(c),a.test(b.className)||(e=this.findSnippetView(b)),{node:b,containerName:d,snippetView:e};b=b.parentNode}return{}},getImageName:function(a){var b,c;return b=config.directives.image.renderedAttr,a.hasAttribute(b)?c=a.getAttribute(b):void 0},getHtmlElementName:function(a){var b,c;return b=config.directives.html.renderedAttr,a.hasAttribute(b)?c=a.getAttribute(b):void 0},getEditableName:function(a){var b,c;return b=config.directives.editable.renderedAttr,a.hasAttribute(b)?(c=a.getAttribute(b),editableName):void 0},dropTarget:function(c,d){var e,f,g,h,i,j,k,l;for(k=d.top,i=d.left,c=this.getElementNode(c),e=config.directives.container.renderedAttr;c&&1===c.nodeType;){if(c.hasAttribute(e)){if(f=c.getAttribute(e),!a.test(c.className))return h=this.getPositionInContainer($(c),{top:k,left:i}),h?(g=this.getInsertPosition(h.$elem[0],h.position),{snippetView:h.snippetView,position:h.position,coords:g}):(l=this.findSnippetView(c),{containerName:f,parent:l,node:c})}else{if(b.test(c.className))return j=this.getPositionInSnippet($(c),{top:k,left:i}),l=this.getSnippetView(c),g=this.getInsertPosition(c,j.position),{snippetView:l,position:j.position,coords:g};if(a.test(c.className))return{root:!0}}c=c.parentNode}return{}},getInsertPosition:function(a,b){var c;return c=this.getBoundingClientRect(a),"before"===b?{top:c.top,left:c.left,width:c.width}:{top:c.bottom,left:c.left,width:c.width}},getPositionInSnippet:function(a,b){var c,d,e,f,g;return g=b.top,f=b.left,e=a.offset().top,d=a.outerHeight(),c=e+d,this.distance(g,e)<this.distance(g,c)?{position:"before"}:{position:"after"}},getPositionInContainer:function(a,b){var c,d,e,f,g,h=this;return g=b.top,f=b.left,c=a.find("."+docClass.snippet),d=void 0,e=void 0,c.each(function(a,b){var c,f,i,j;return c=$(b),j=c.offset().top,i=c.outerHeight(),f=j+i,(!d||h.distance(g,j)<d)&&(d=h.distance(g,j),e={$elem:c,position:"before"}),(!d||h.distance(g,f)<d)&&(d=h.distance(g,f),e={$elem:c,position:"after"}),e?e.snippetView=h.getSnippetView(e.$elem[0]):void 0}),e},distance:function(a,b){return a>b?a-b:b-a},maximizeContainerHeight:function(a){var b,c,d,e,f,g,h,i;if(a.template.containerCount>1){h=a.containers,i=[];for(e in h)d=h[e],b=$(d),b.hasClass(docClass.maximizedContainer)||(c=b.parent(),g=c.height(),f=b.outerHeight(!0)-b.height(),b.height(g-f),i.push(b.addClass(docClass.maximizedContainer)));return i}},restoreContainerHeight:function(){return $("."+docClass.maximizedContainer).css("height","").removeClass(docClass.maximizedContainer)},getElementNode:function(a){return(null!=a?a.jquery:void 0)?a[0]:3===(null!=a?a.nodeType:void 0)?a.parentNode:a},getSnippetView:function(a){return $(a).data("snippet")},getBoundingClientRect:function(a){var b,c,d;return b=a.getBoundingClientRect(),c=void 0!==window.pageXOffset?window.pageXOffset:(B.documentElement||window.document.body.parentNode||window.document.body).scrollLeft,d=void 0!==window.pageYOffset?window.pageYOffset:(B.documentElement||window.document.body.parentNode||window.document.body).scrollTop,b={top:b.top+d,bottom:b.bottom+d,left:b.left+c,right:b.right+c},b.height=b.bottom-b.top,b.width=b.right-b.left,b}}}(),g=function(){function a(b){this.defaultOptions=$.extend({longpressDelay:0,longpressDistanceLimit:10,minDistance:0,direct:!1,preventDefault:!0,createPlaceholder:a.placeholder,scrollNearEdge:50},b),this.drag={},this.$origin=void 0,this.$dragged=void 0}return a.prototype.mousedown=function(a,b,c){var d=this;return null==c&&(c={}),this.reset(),this.drag.initialized=!0,this.options=$.extend({},this.defaultOptions,c),this.drag.startPoint="touchstart"===b.type?{left:b.originalEvent.changedTouches[0].pageX,top:b.originalEvent.changedTouches[0].pageY}:{left:b.pageX,top:b.pageY},this.$origin=a,this.options.longpressDelay&&this.options.longpressDistanceLimit&&(this.drag.timeout=setTimeout(function(){return d.start()},this.options.longpressDelay)),this.options.preventDefault?b.preventDefault():void 0},a.prototype.start=function(){var a,b,c;return this.drag.started=!0,a=this.drag.startPoint.left,b=this.drag.startPoint.top,"function"==typeof this.options.onDragStart&&this.options.onDragStart.call(this,this.drag,{left:a,top:b}),$(window.document.body).addClass(docClass.preventSelection),this.$dragged=this.options.direct?this.$origin:this.options.createPlaceholder(this.drag,this.$origin),this.drag.fixed&&(this.drag.$body=$(window.document.body)),this.move(a,b),this.direct?void 0:(this.$dragged.appendTo(window.document.body).show(),null!=(c=this.$origin)?c.addClass(docClass.dragged):void 0)},a.prototype.scrollIntoView=function(a){var b,c,d,e,f,g,h;return this.lastScrollPosition&&(c=a-this.lastScrollPosition,h=$(window).scrollTop(),g=h+$(window).height(),f=0>c?(e=a<h+this.defaultOptions.scrollNearEdge,0!==h&&e):(b=g-$(window).height()<$(window.document).height(),d=a>g-this.defaultOptions.scrollNearEdge,b&&d),f&&window.scrollBy(0,c)),this.lastScrollPosition=a},a.prototype.move=function(a,b,c){var d,e;if(this.drag.started){if(this.drag.mouseToSnippet?(d=a-this.drag.mouseToSnippet.left,e=b-this.drag.mouseToSnippet.top):(d=a,e=b),this.drag.fixed&&(e-=this.drag.$body.scrollTop(),d-=this.drag.$body.scrollLeft()),2>d&&(d=2),2>e&&(e=2),this.$dragged.css({position:"absolute",left:""+d+"px",top:""+e+"px"}),this.scrollIntoView(e,c),!this.direct)return this.dropTarget(a,b,c)}else if(this.drag.initialized&&(this.options.longpressDelay&&this.options.longpressDistanceLimit&&this.distance({left:a,top:b},this.drag.startPoint)>this.options.longpressDistanceLimit&&this.reset(),this.options.minDistance&&this.distance({left:a,top:b},this.drag.startPoint)>this.options.minDistance))return this.start()},a.prototype.drop=function(){return this.drag.started&&"function"==typeof this.options.onDrop&&this.options.onDrop.call(this,this.drag,this.$origin),this.reset()},a.prototype.dropTarget=function(a,b,c){var d,e,f,g;return this.$dragged&&c&&(e=void 0,"touchstart"===c.type||"touchmove"===c.type?(f=c.originalEvent.changedTouches[0].clientX,g=c.originalEvent.changedTouches[0].clientY):(f=c.clientX,g=c.clientY),f&&g&&(this.$dragged.hide(),e=window.document.elementFromPoint(f,g),this.$dragged.show()),e?(d=C.dropTarget(e,{top:b,left:a}),this.drag.target=d):this.drag.target={},"function"==typeof this.options.onDrag)?this.options.onDrag.call(this,this.drag.target,this.drag,{left:a,top:b}):void 0},a.prototype.distance=function(a,b){var c,d;return a&&b?(c=a.left-b.left,d=a.top-b.top,Math.sqrt(c*c+d*d)):void 0},a.prototype.reset=function(){return this.drag.initialized?(this.drag.timeout&&clearTimeout(this.drag.timeout),this.drag.preview&&this.drag.preview.remove(),this.$dragged&&this.$dragged!==this.$origin&&this.$dragged.remove(),this.$origin&&(this.$origin.removeClass(docClass.dragged),this.$origin.show()),$(window.document.body).removeClass(docClass.preventSelection),this.drag={},this.$origin=void 0,this.$dragged=void 0):void 0},a}(),g.cloneOrigin=function(a,b){var c,d,e,f,g,h,i;return a.mouseToSnippet||(h=b.offset(),g=parseFloat(b.css("margin-top")),f=parseFloat(b.css("margin-left")),a.mouseToSnippet={left:mouseLeft-h.left+f,top:mouseTop-h.top+g}),i=a.width||b.width(),d=b.clone(),d.css({position:"absolute",width:i}).removeClass(docClass.snippetHighlight).addClass(docClass.draggedPlaceholder),c=b.css("background-color"),e="transparent"!==c&&"rgba(0, 0, 0, 0)"!==c,e||d.css({"background-color":"#fff"}),d},g.placeholder=function(a){var b,c,d,e;return d=a.width,c=1,a.mouseToSnippet||(a.mouseToSnippet={left:2,top:-15}),e='<div class="doc-drag-placeholder-item">\n  <span class="doc-drag-counter">'+c+"</span>\n  Selected Item\n</div>",b=$(e),d&&b.css({width:d}),b.css({position:"absolute"})},h=function(){function a(a){this.page=a,Editable.init({log:!1}),this.editableAttr=config.directives.editable.renderedAttr,this.selection=$.Callbacks(),Editable.focus(this.withContext(this.focus)).blur(this.withContext(this.blur)).insert(this.withContext(this.insert)).merge(this.withContext(this.merge)).split(this.withContext(this.split)).selection(this.withContext(this.selectionChanged)).newline(this.withContext(this.newline))}return a.prototype.add=function(a){return Editable.add(a)},a.prototype.disableAll=function(){return $("[contenteditable]").attr("contenteditable","false")},a.prototype.reenableAll=function(){return $("[contenteditable]").attr("contenteditable","true")},a.prototype.withContext=function(a){var b=this;return function(){var c,d,e,f;return e=arguments[0],c=2<=arguments.length?O.call(arguments,1):[],f=C.findSnippetView(e),d=e.getAttribute(b.editableAttr),c.unshift(f,d),a.apply(b,c)}},a.prototype.updateModel=function(a,b){var c;return c=a.get(b),(config.singleLineBreak.test(c)||""===c)&&(c=void 0),a.model.set(b,c)},a.prototype.focus=function(a,b){var c;return a.focusEditable(b),c=a.getDirectiveElement(b),this.page.focus.editableFocused(c,a),!0},a.prototype.blur=function(a,b){var c;return a.blurEditable(b),c=a.getDirectiveElement(b),this.page.focus.editableBlurred(c,a),this.updateModel(a,b),!0},a.prototype.insert=function(a,b,c){var d,e,f,g;return this.hasSingleEditable(a)&&(f=config.editable.insertSnippet,g=B.design.get(f),d=g.createModel(),e="before"===c?(a.model.before(d),a.prev()):(a.model.after(d),a.next()),e&&e.focus()),!1},a.prototype.merge=function(a,b,c,d){var e,f,g,h,i,j,k;if(this.hasSingleEditable(a)&&(i="before"===c?a.prev():a.next(),i&&i.template===a.template)){for(e=a.directives.$getElem(b).contents(),h=this.page.document.createDocumentFragment(),j=0,k=e.length;k>j;j++)f=e[j],h.appendChild(f);i.focus(),g=i.getDirectiveElement(b),d=Editable.createCursor(g,"before"===c?"end":"beginning"),d["before"===c?"insertAfter":"insertBefore"](h),d.save(),this.updateModel(i,b),d.restore(),a.model.remove(),d.setSelection()}return!1},a.prototype.split=function(a,b,c,d){var e,f,g;return this.hasSingleEditable(a)&&(g=a.template.createModel(),f=c.querySelector("*").innerHTML,e=d.querySelector("*").innerHTML,a.model.set(b,f),g.set(b,e),a.model.after(g),a.next().focus()),!1},a.prototype.selectionChanged=function(a,b,c){var d;return d=a.getDirectiveElement(b),this.selection.fire(a,d,c)},a.prototype.newline=function(){return!1},a.prototype.hasSingleEditable=function(a){return 1===a.directives.length&&"editable"===a.directives[0].type},a}(),i=function(){function a(){this.editableNode=void 0,this.snippetView=void 0,this.snippetFocus=$.Callbacks(),this.snippetBlur=$.Callbacks()}return a.prototype.setFocus=function(a,b){return b!==this.editableNode&&(this.resetEditable(),this.editableNode=b),a!==this.snippetView&&(this.resetSnippetView(),a)?(this.snippetView=a,this.snippetFocus.fire(this.snippetView)):void 0},a.prototype.editableFocused=function(a,b){return this.editableNode!==a?(b||(b=C.findSnippetView(a)),this.setFocus(b,a)):void 0},a.prototype.editableBlurred=function(a){return this.editableNode===a?this.setFocus(this.snippetView,void 0):void 0},a.prototype.snippetFocused=function(a){return this.snippetView!==a?this.setFocus(a,void 0):void 0},a.prototype.blur=function(){return this.setFocus(void 0,void 0)},a.prototype.resetEditable=function(){return this.editableNode?this.editableNode=void 0:void 0},a.prototype.resetSnippetView=function(){var a;return this.snippetView?(a=this.snippetView,this.snippetView=void 0,this.snippetBlur.fire(a)):void 0},a}(),H=function(){return{init:function(a){var b,c,d,e,f,g=this;return f=a.xmlTemplate,e=a.scriptNode,c=a.destination,b=a.design,e&&(f=$(e).text()),w(f,'Please provide parameter "xmlTemplate" or "scriptNode"'),d=$(c)[0],doc.document.initialized||doc.init({design:b,rootNode:d}),doc.ready(function(){var a,b,c,d,e;for(a=g.parseDocumentTemplate(f),e=[],c=0,d=a.length;d>c;c++)b=a[c],e.push(doc.add(b));return e})},parseDocumentTemplate:function(a){var b;return b=$.parseXML("<root>"+a+"</root>").firstChild,this.addRootSnippets($(b).children())},addRootSnippets:function(a){var b,c,d,e,f,g;for(c=[],b=f=0,g=a.length;g>f;b=++f)e=a[b],d=doc.create(this.nodeToSnippetName(e)),c.push(d),this.setChildren(d,e);return c},setChildren:function(a,b){return this.populateSnippetContainers(a,b),this.setEditables(a,b),this.setEditableStyles(a,b)},populateSnippetContainers:function(a,b){var c,d,e,f,g,h,i,j,k,l,m,n,o,p;if(g=a.template.directives,1===g.length&&g.container&&(i=!0,e=g.container[0]),i&&!this.descendants(b,e.name).length){for(n=this.descendants(b),o=[],j=0,l=n.length;l>j;j++)c=n[j],o.push(this.appendSnippetToContainer(a,c,e.name));return o}for(f=a.containers?Object.keys(a.containers):[],p=[],k=0,m=f.length;m>k;k++)d=f[k],p.push(function(){var e,f,g,i;for(g=this.descendants(b,d),i=[],e=0,f=g.length;f>e;e++)h=g[e],i.push(function(){var b,d,e,f;for(e=this.descendants(h),f=[],b=0,d=e.length;d>b;b++)c=e[b],f.push(this.appendSnippetToContainer(a,c,this.nodeNameToCamelCase(h)));return f}.call(this));return i}.call(this));return p},appendSnippetToContainer:function(a,b,c){var d;return d=doc.create(this.nodeToSnippetName(b)),a.append(c,d),this.setChildren(d,b)},setEditables:function(a,b){var c,d,e;e=[];for(c in a.content)d=this.getValueForEditable(c,b,a.template.directives.length),d?e.push(a.set(c,d)):e.push(void 0);return e},getValueForEditable:function(a,b,c){var d,e;return d=this.descendants(b,a)[0],e=this.getXmlValue(d),e||1!==c||(J.warn("The editable '"+a+"' of '"+this.nodeToSnippetName(b)+"' has no content. Display parent HTML instead."),e=this.getXmlValue(b)),e},nodeNameToCamelCase:function(a){return words.camelize(a.nodeName)},setEditableStyles:function(a,b){var c,d,e,f,g;if(d=$(b).attr(config.kickstart.attr.styles)){for(d=d.split(/\s*;\s*/),g=[],e=0,f=d.length;f>e;e++)c=d[e],c=c.split(/\s*:\s*/),c.length>1?g.push(a.setStyle(c[0],c[1])):g.push(void 0);return g}},nodeToSnippetName:function(a){var b,c;return c=this.nodeNameToCamelCase(a),b=doc.getDesign().get(c),w(b,"The Template named '"+c+"' does not exist."),c},descendants:function(a,b){var c;return b&&(c=words.snakeCase(b)),$(a).children(c)},getXmlValue:function(a){var b,c,d;return a&&(d=(new XMLSerializer).serializeToString(a),c=d.indexOf(">")+1,b=d.lastIndexOf("<"),b>c)?d.substring(c,b):void 0}}}(),m=function(){function a(a){this.snippetTree=a.snippetTree,this.renderingContainer=a.renderingContainer,w(this.snippetTree,"no snippet tree specified"),w(this.renderingContainer,"no rendering container specified"),this.$root=$(this.renderingContainer.renderNode),this.setupSnippetTreeListeners(),this.snippetViews={},this.readySemaphore=new o,this.renderOncePageReady(),this.readySemaphore.start()}return a.prototype.renderOncePageReady=function(){var a=this;return this.readySemaphore.increment(),this.renderingContainer.ready(function(){return a.render(),a.readySemaphore.decrement()})},a.prototype.ready=function(a){return this.readySemaphore.addCallback(a)},a.prototype.isReady=function(){return this.readySemaphore.isReady()},a.prototype.html=function(){return w(this.isReady(),"Cannot generate html. Renderer is not ready."),this.renderingContainer.html()},a.prototype.setupSnippetTreeListeners=function(){return this.snippetTree.snippetAdded.add($.proxy(this.snippetAdded,this)),this.snippetTree.snippetRemoved.add($.proxy(this.snippetRemoved,this)),this.snippetTree.snippetMoved.add($.proxy(this.snippetMoved,this)),this.snippetTree.snippetContentChanged.add($.proxy(this.snippetContentChanged,this)),this.snippetTree.snippetHtmlChanged.add($.proxy(this.snippetHtmlChanged,this))},a.prototype.snippetAdded=function(a){return this.insertSnippet(a)},a.prototype.snippetRemoved=function(a){return this.removeSnippet(a),this.deleteCachedSnippetViewForSnippet(a)},a.prototype.snippetMoved=function(a){return this.removeSnippet(a),this.insertSnippet(a)},a.prototype.snippetContentChanged=function(a){return this.snippetViewForSnippet(a).updateContent()},a.prototype.snippetHtmlChanged=function(a){return this.snippetViewForSnippet(a).updateHtml()},a.prototype.snippetViewForSnippet=function(a){var b,c;return(b=this.snippetViews)[c=a.id]||(b[c]=a.createView(this.renderingContainer.isReadOnly))},a.prototype.deleteCachedSnippetViewForSnippet=function(a){return delete this.snippetViews[a.id]},a.prototype.render=function(){var a=this;return this.snippetTree.each(function(b){return a.insertSnippet(b)})},a.prototype.clear=function(){var a=this;return this.snippetTree.each(function(b){return a.snippetViewForSnippet(b).setAttachedToDom(!1)}),this.$root.empty()},a.prototype.redraw=function(){return this.clear(),this.render()},a.prototype.insertSnippet=function(a){var b;if(!this.isSnippetAttached(a))return this.isSnippetAttached(a.previous)?this.insertSnippetAsSibling(a.previous,a):this.isSnippetAttached(a.next)?this.insertSnippetAsSibling(a.next,a):a.parentContainer?this.appendSnippetToParentContainer(a):J.error("Snippet could not be inserted by renderer."),b=this.snippetViewForSnippet(a),b.setAttachedToDom(!0),this.renderingContainer.snippetViewWasInserted(b),this.attachChildSnippets(a)},a.prototype.isSnippetAttached=function(a){return a&&this.snippetViewForSnippet(a).isAttachedToDom},a.prototype.attachChildSnippets=function(a){var b=this;return a.children(function(a){return b.isSnippetAttached(a)?void 0:b.insertSnippet(a)})},a.prototype.insertSnippetAsSibling=function(a,b){var c;return c=a===b.previous?"after":"before",this.$nodeForSnippet(a)[c](this.$nodeForSnippet(b))},a.prototype.appendSnippetToParentContainer=function(a){return this.$nodeForSnippet(a).appendTo(this.$nodeForContainer(a.parentContainer))},a.prototype.$nodeForSnippet=function(a){return this.snippetViewForSnippet(a).$html},a.prototype.$nodeForContainer=function(a){var b;return a.isRoot?this.$root:(b=this.snippetViewForSnippet(a.parentSnippet),$(b.getDirectiveElement(a.name)))},a.prototype.removeSnippet=function(a){return this.snippetViewForSnippet(a).setAttachedToDom(!1),this.$nodeForSnippet(a).detach()},a}(),r=function(){function a(a){var b,c;c=a.snippet,b=a.page,this.snippet=c,this.page=b,this.$highlightedContainer={},this.onStart=$.proxy(this.onStart,this),this.onDrag=$.proxy(this.onDrag,this),this.onDrop=$.proxy(this.onDrop,this),this.classAdded=[]}return a.prototype.onStart=function(){return this.page.snippetWillBeDragged.fire(this.snippet),this.$insertPreview=$("<div class='doc-drag-preview'>"),this.page.$body.append(this.$insertPreview).css("cursor","pointer"),this.page.editableController.disableAll(),this.page.blurFocusedElement()},a.prototype.removeCssClasses=function(){var a,b,c,d;for(d=this.classAdded,b=0,c=d.length;c>b;b++)a=d[b],a.removeClass(docClass.afterDrop).removeClass(docClass.beforeDrop);return this.classAdded=[]},a.prototype.isValidTarget=function(a){return a.snippetView&&a.snippetView.model!==this.snippet?!0:a.containerName?!0:!1},a.prototype.onDrag=function(a){var b,c,d,e;return this.isValidTarget(a)||(b=a={}),a.containerName?(C.maximizeContainerHeight(a.parent),b=$(a.node)):a.snippetView?(C.maximizeContainerHeight(a.snippetView),b=a.snippetView.get$container(),b.addClass(docClass.containerHighlight)):b=a={},b[0]!==this.$highlightedContainer[0]&&("function"==typeof(d=this.$highlightedContainer).removeClass&&d.removeClass(docClass.containerHighlight),this.$highlightedContainer=b,"function"==typeof(e=this.$highlightedContainer).addClass&&e.addClass(docClass.containerHighlight)),a.coords?(c=a.coords,this.$insertPreview.css({left:""+c.left+"px",top:""+(c.top-5)+"px",width:""+c.width+"px"}).show()):this.$insertPreview.hide()},a.prototype.onDrop=function(a){var b,c,d;return this.page.$body.css("cursor",""),this.page.editableController.reenableAll(),this.$insertPreview.remove(),"function"==typeof(d=this.$highlightedContainer).removeClass&&d.removeClass(docClass.containerHighlight),C.restoreContainerHeight(),c=a.target,c&&this.isValidTarget(c)?((b=c.snippetView)?"before"===c.position?b.model.before(this.snippet):b.model.after(this.snippet):c.containerName&&c.parent.model.append(c.containerName,this.snippet),this.page.snippetWasDropped.fire(this.snippet)):void 0},a}(),u=function(){function a(a){this.model=a.model,this.$html=a.$html,this.directives=a.directives,this.isReadOnly=a.isReadOnly,this.template=this.model.template,this.isAttachedToDom=!1,this.wasAttachedToDom=$.Callbacks(),this.isReadOnly||this.$html.data("snippet",this).addClass(docClass.snippet).attr(docAttr.template,this.template.identifier),this.render()}return a.prototype.render=function(){return this.updateContent(),this.updateHtml()},a.prototype.updateContent=function(){return this.content(this.model.content),this.hasFocus()||this.displayOptionals(),this.stripHtmlIfReadOnly()},a.prototype.updateHtml=function(){var a,b,c;c=this.model.styles;for(a in c)b=c[a],this.style(a,b);return this.stripHtmlIfReadOnly()},a.prototype.displayOptionals=function(){var a=this;return this.directives.each(function(b){var c;return b.optional?(c=$(b.elem),a.model.isEmpty(b.name)?c.css("display","none"):c.css("display","")):void 0})},a.prototype.showOptionals=function(){return this.directives.each(function(a){return a.optional?config.animations.optionals.show($(a.elem)):void 0})},a.prototype.hideEmptyOptionals=function(){var a=this;return this.directives.each(function(b){return b.optional&&a.model.isEmpty(b.name)?config.animations.optionals.hide($(b.elem)):void 0})},a.prototype.next=function(){return this.$html.next().data("snippet")},a.prototype.prev=function(){return this.$html.prev().data("snippet")},a.prototype.afterFocused=function(){return this.$html.addClass(docClass.snippetHighlight),this.showOptionals()},a.prototype.afterBlurred=function(){return this.$html.removeClass(docClass.snippetHighlight),this.hideEmptyOptionals()},a.prototype.focus=function(){var a,b;return a=null!=(b=this.directives.editable)?b[0].elem:void 0,$(a).focus()},a.prototype.hasFocus=function(){return this.$html.hasClass(docClass.snippetHighlight)},a.prototype.getBoundingClientRect=function(){return C.getBoundingClientRect(this.$html[0])},a.prototype.content=function(a){var b,c,d;d=[];for(b in a)c=a[b],d.push(this.set(b,c));return d},a.prototype.set=function(a,b){var c;switch(c=this.directives.get(a),c.type){case"editable":return this.setEditable(a,b);case"image":return this.setImage(a,b);case"html":return this.setHtml(a,b)}},a.prototype.get=function(a){var b;switch(b=this.directives.get(a),b.type){case"editable":return this.getEditable(a);case"image":return this.getImage(a);case"html":return this.getHtml(a)}},a.prototype.getEditable=function(a){var b;return b=this.directives.$getElem(a),b.html()},a.prototype.setEditable=function(a,b){var c,d;return c=this.directives.$getElem(a),d=b?config.zeroWidthCharacter:this.template.defaults[a],c.attr(config.html.attr.placeholder,d),c.html(b||"")},a.prototype.focusEditable=function(a){var b;return b=this.directives.$getElem(a),b.attr(config.html.attr.placeholder,config.zeroWidthCharacter)},a.prototype.blurEditable=function(a){var b;return b=this.directives.$getElem(a),this.model.isEmpty(a)?b.attr(config.html.attr.placeholder,this.template.defaults[a]):void 0},a.prototype.getHtml=function(a){var b;return b=this.directives.$getElem(a),b.html()},a.prototype.setHtml=function(a,b){var c;return c=this.directives.$getElem(a),c.html(b||""),b?b&&!this.isReadOnly&&this.blockInteraction(c):c.html(this.template.defaults[a]),this.directivesToReset||(this.directivesToReset={}),this.directivesToReset[a]=a},a.prototype.getDirectiveElement=function(a){var b;return null!=(b=this.directives.get(a))?b.elem:void 0},a.prototype.resetDirectives=function(){var a,b,c;c=[];for(b in this.directivesToReset)a=this.directives.$getElem(b),a.find("iframe").length?c.push(this.set(b,this.model.content[b])):c.push(void 0);return c},a.prototype.getImage=function(a){var b;return b=this.directives.$getElem(a),b.attr("src")},a.prototype.setImage=function(a,b){var c,d;
return c=this.directives.$getElem(a),b?(this.cancelDelayed(a),this.setImageAttribute(c,b)):(d=$.proxy(this.setPlaceholderImage,this,c),this.delayUntilAttached(a,d))},a.prototype.setImageAttribute=function(a,b){return"IMG"===a[0].nodeName?a.attr("src",b):a.attr("style","background-image:url("+b+")")},a.prototype.setPlaceholderImage=function(a){var b,c,d;return"IMG"===a[0].nodeName?(d=a.width(),b=a.height()):(d=a.outerWidth(),b=a.outerHeight()),c="http://placehold.it/"+d+"x"+b+"/BEF56F/B2E668",this.setImageAttribute(a,c)},a.prototype.style=function(a,b){var c,d,e,f,g;if(c=this.template.styles[a].cssClassChanges(b),c.remove)for(g=c.remove,e=0,f=g.length;f>e;e++)d=g[e],this.$html.removeClass(d);return this.$html.addClass(c.add)},a.prototype.disableTabbing=function(a){return setTimeout(function(){return a.find("iframe").attr("tabindex","-1")},400)},a.prototype.blockInteraction=function(a){var b;return this.ensureRelativePosition(a),b=$("<div class='"+docClass.interactionBlocker+"'>").attr("style","position: absolute; top: 0; bottom: 0; left: 0; right: 0;"),a.append(b),this.disableTabbing(a)},a.prototype.ensureRelativePosition=function(a){var b;return b=a.css("position"),"absolute"!==b&&"fixed"!==b&&"relative"!==b?a.css("position","relative"):void 0},a.prototype.get$container=function(){return $(C.findContainer(this.$html[0]).node)},a.prototype.delayUntilAttached=function(a,b){var c=this;return this.isAttachedToDom?b():(this.cancelDelayed(a),this.delayed||(this.delayed={}),this.delayed[a]=D.callOnce(this.wasAttachedToDom,function(){return c.delayed[a]=void 0,b()}))},a.prototype.cancelDelayed=function(a){var b;return(null!=(b=this.delayed)?b[a]:void 0)?(this.wasAttachedToDom.remove(this.delayed[a]),this.delayed[a]=void 0):void 0},a.prototype.stripHtmlIfReadOnly=function(){var a,b,c;if(this.isReadOnly){for(b=new f(this.$html[0]),c=[];a=b.nextElement();)this.stripDocClasses(a),this.stripDocAttributes(a),c.push(this.stripEmptyAttributes(a));return c}},a.prototype.stripDocClasses=function(a){var b,c,d,e,f,g;for(b=$(a),f=a.className.split(/\s+/),g=[],d=0,e=f.length;e>d;d++)c=f[d],/doc\-.*/i.test(c)?g.push(b.removeClass(c)):g.push(void 0);return g},a.prototype.stripDocAttributes=function(a){var b,c,d,e,f,g,h;for(b=$(a),g=Array.prototype.slice.apply(a.attributes),h=[],e=0,f=g.length;f>e;e++)c=g[e],d=c.name,/data\-doc\-.*/i.test(d)?h.push(b.removeAttr(d)):h.push(void 0);return h},a.prototype.stripEmptyAttributes=function(a){var b,c,d,e,f,g,h,i,j;for(b=$(a),f=["style","class"],i=Array.prototype.slice.apply(a.attributes),j=[],g=0,h=i.length;h>g;g++)c=i[g],e=f.indexOf(c.name)>=0,d=""===c.value.trim(),e&&d?j.push(b.removeAttr(c.name)):j.push(void 0);return j},a.prototype.setAttachedToDom=function(a){return a!==this.isAttachedToDom?(this.isAttachedToDom=a,a?(this.resetDirectives(),this.wasAttachedToDom.fire()):void 0):void 0},a}(),this.doc=function(a){return B.find(a)},x=y(doc),M=function(){return this.kickstart=x(H,"init"),this.init=x(B,"init"),this.ready=x(B.ready,"add"),this.createView=$.proxy(B,"createView"),this.getDesign=function(){return B.design},this.add=$.proxy(B,"add"),this.create=$.proxy(B,"createModel"),this.toJson=$.proxy(B,"toJson"),this.toHtml=$.proxy(B,"toHtml"),this.readableJson=function(){return words.readableJson(B.toJson())},this.snippetFromJson=$.proxy(s,"fromJson"),this.printTree=$.proxy(B,"printTree"),this.eachContainer=x(B,"eachContainer"),this.document=B,this.changed=x(B.changed,"add"),this.DragDrop=g,N.init(),this.stash=$.proxy(N,"stash"),this.stash.snapshot=$.proxy(N,"snapshot"),this.stash["delete"]=$.proxy(N,"delete"),this.stash.clear=$.proxy(N,"clear"),this.stash.restore=$.proxy(N,"restore"),this.stash.get=$.proxy(N,"get"),this.stash.list=$.proxy(N,"list"),this.words=words,this.fn=p.prototype},L=function(){var a;return a=B.page,this.restore=x(B,"restore"),this.snippetFocused=x(a.focus.snippetFocus,"add"),this.snippetBlurred=x(a.focus.snippetBlur,"add"),this.snippetAdded=x(B.snippetTree.snippetAdded,"add"),this.snippetDataChanged=x(B.snippetTree.snippetDataChanged,"add"),this.startDrag=$.proxy(a,"startDrag"),this.snippetWillBeDragged=$.proxy(a.snippetWillBeDragged,"add"),this.snippetWillBeDragged.remove=$.proxy(a.snippetWillBeDragged,"remove"),this.snippetWasDropped=$.proxy(a.snippetWasDropped,"add"),this.snippetWasDropped.remove=$.proxy(a.snippetWasDropped,"remove"),this.imageClick=x(a.imageClick,"add"),this.htmlElementClick=x(a.htmlElementClick,"add"),this.textSelection=x(a.editableController.selection,"add")},M.call(doc),doc.ready(function(){return L.call(doc)})}).call(this);