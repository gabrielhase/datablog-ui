!function(){var a,b,c,d,e,f,g,h,i,j,k,l,m,n,o,p,q,r,s,t,u,v,w,x,y,z,A,B,C,D,E,F,G,H,I,J,K,L,M,N,O,P,Q,R,S,T,U=[].slice;z={wordSeparators:"./\\()\"':,.;<>~!#%^&*|+=[]{}`~?",attributePrefix:"data"},B={section:"doc-section",snippet:"doc-snippet",editable:"doc-editable","interface":"doc-ui",snippetHighlight:"doc-snippet-highlight",containerHighlight:"doc-container-highlight",draggedPlaceholder:"doc-dragged-placeholder",dragged:"doc-dragged",beforeDrop:"doc-before-drop",afterDrop:"doc-after-drop",preventSelection:"doc-no-selection",maximizedContainer:"doc-js-maximized-container"},Q={editable:"doc-editable",container:"doc-container",image:"doc-image",defaultValues:{editable:"default",container:"default",image:"image"}},R={};for(L in Q)S=Q[L],R[S]=L;A={template:"doc-template"};for(M in Q)T=Q[M],A[M]=T;if(z.attributePrefix)for(G in A)T=A[G],A[G]=""+z.attributePrefix+"-"+T;y=function(a){return function(b,c){var d,e,f;return"string"==typeof c&&(f=b[c],c=b,b=f),d=Array.prototype.slice.call(arguments,2),e=function(){return b.apply(c||this,d.concat(Array.prototype.slice.call(arguments))),a}}},E=function(){var a,b;return a=b=void 0,{next:function(c){var d;return null==c&&(c="doc"),d=Date.now().toString(32),b===d?a+=1:(a=0,b=d),""+c+"-"+d+a}}}(),F=function(){return{empty:/^\s*$/,whitespace:/\s+/g,normalizeWhitespace:!0,compareElement:function(a,b){return this.compareTag(a,b)&&this.compareAttributes(a,b)?!0:void 0},compareTag:function(a,b){return this.getTag(a)===this.getTag(b)},getTag:function(a){return a.namespaceURI+":"+a.localName},compareAttributes:function(a,b){var c,d,e,f,g;if(a.attributes.length===b.attributes.length){for(g=a.attributes,e=0,f=g.length;f>e;e++)if(c=g[e],d=b.getAttribute(c.name),!this.compareAttributeValue(c.name,c.value,d))return!1;return!0}},compareAttributeValue:function(a,b,c){var d,e,f,g;if(null==b&&null==c)return!0;if(null==b||null==c)return!1;switch(a){case"class":return e=b.split(" ").sort(),g=c.split(" ").sort(),e.join(" ")===g.join(" ");case"style":return d=this.prepareStyleValue(b),f=this.prepareStyleValue(c),d===f;default:return b===c}},prepareStyleValue:function(a){return a=$.trim(a).replace(/\s*:\s*/g,":").replace(/\s*;\s*/g,";").replace(/;$/g,""),a.split(";").sort().join(";")},compareNode:function(a,b){if(null!=a&&null!=b&&a.nodeType===b.nodeType)switch(a.nodeType){case 1:return this.compareElement(a,b);case 3:return this.compareText(a,b);default:return J.error("HtmlCompare: nodeType "+a.nodeType+" not supported")}},compareText:function(a,b){var c,d;return this.normalizeWhitespace?(c=$.trim(a.textContent).replace(this.whitespace," "),d=$.trim(b.textContent).replace(this.whitespace," "),c===d):a.nodeValue===b.nodeValue},isEmptyTextNode:function(a){return this.empty.test(a.nodeValue)},compare:function(a,b){var c,d,e;for("string"==typeof a&&(a=$(a)),"string"==typeof b&&(b=$(b)),a.jquery&&(a=a[0]),b.jquery&&(b=b[0]),d=this.iterateComparables(a),e=this.iterateComparables(b),c=!0;c;)c=this.compareNode(a=d(),b=e());return null==a&&null==b?!0:!1},isComparable:function(a){var b;return b=a.nodeType,1===b||3===b&&!this.isEmptyTextNode(a)?!0:void 0},iterateComparables:function(a){var b,c=this;return b=this.iterate(a),function(){for(var a;a=b();)if(c.isComparable(a))return a}},iterate:function(a){var b,c;return b=c=a,function(){var d;if(L=b=c,d=c=void 0,b)if(d=L.firstChild)c=d;else for(;L!==a&&!(c=L.nextSibling);)L=L.parentNode;return b}}}}(),jQuery.fn.outerHtml=jQuery.fn.outerHtml||function(){var a,b,c;if(a=this[0]){if("undefined"!=typeof a.outerHTML)return a.outerHTML;try{return(new XMLSerializer).serializeToString(a)}catch(d){b=d;try{return a.xml}catch(d){c=d}}}},jQuery.fn.replaceClass=function(a,b){return this.removeClass(a),this.addClass(b)},jQuery.fn.findIn=function(a){return this.find(a).add(this.filter(a))},h=function(){function a(a,b){this.key=a,this.limit=b,this.limit||(this.limit=10),this.index=void 0}return a.prototype.push=function(a){var b,c,d;for(c={key:this.nextKey(),date:Date.now()},b=this.getIndex(),b.push(c);b.length>this.limit;)d=b[0],b.splice(0,1),I.remove(d.key);return I.set(c.key,a),I.set(""+this.key+"--index",b)},a.prototype.pop=function(){var a,b;return a=this.getIndex(),a&&a.length?(b=a.pop(),T=I.get(b.key),I.remove(b.key),this.setIndex(),T):void 0},a.prototype.get=function(a){var b,c;return b=this.getIndex(),b&&b.length?(a||(a=b.length-1),c=b[a],T=I.get(c.key)):void 0},a.prototype.clear=function(){var a,b;for(a=this.getIndex();b=a.pop();)I.remove(b.key);return this.setIndex()},a.prototype.getIndex=function(){return this.index||(this.index=I.get(""+this.key+"--index")||[]),this.index},a.prototype.setIndex=function(){return this.index?I.set(""+this.key+"--index",this.index):void 0},a.prototype.nextKey=function(){var a;return a=Math.floor(1e16*Math.random()).toString(32),""+this.key+"-"+a},a}(),I=function(){var a;return a=jQuery,{set:function(a,b){return store.set(a,b)},get:function(a){return store.get(a)},remove:function(a){return store.remove(a)},clear:function(){return store.clear()},disbled:function(){return store.disabled}}}(),J=function(){var a;return a=1<=arguments.length?U.call(arguments,0):[],null!=window.console?(a.length&&"trace"===a[a.length-1]&&(a.pop(),null!=window.console.trace&&window.console.trace()),window.console.log.apply(window.console,a),void 0):void 0},function(){var a;return a=function(a,b){if(null==b&&(b="error"),"undefined"!=typeof _rollbar&&null!==_rollbar)_rollbar.push(new Error(a),function(){var c;return"critical"!==b&&"error"!==b||null==(null!=(c=window.console)?c.error:void 0)?J.call(void 0,a):window.console.error.call(window.console,a)});else{if("critical"===b||"error"===b)throw new Error(a);J.call(void 0,a)}return void 0},J.debug=function(b){return a(b,"debug")},J.warn=function(b){return a(b,"warning")},J.error=function(b){return a(b,"error")}}(),K=function(){var a,b,c,d,e;for(d=1<=arguments.length?U.call(arguments,0):[],a=function(){},e=d.length-1;e>=0;e+=-1){c=d[e];for(M in c)b=c[M],a.prototype[M]=b}return a},q=function(){function a(a){this.root=this._next=a}return a.prototype.current=null,a.prototype.hasNext=function(){return!!this._next},a.prototype.next=function(){var a,b;if(L=this.current=this._next,a=b=void 0,this.current)if(a=L.firstChild,a&&1===L.nodeType&&!L.hasAttribute(A.container))this._next=a;else{for(b=null;L!==this.root&&!(b=L.nextSibling);)L=L.parentNode;this._next=b}return this.current},a.prototype.nextElement=function(){for(;this.next()&&1!==this.current.nodeType;);return this.current},a.prototype.detach=function(){return this.current=this._next=this.root=null},a}(),P=function(){var a;return a=!1,{init:function(){return a?void 0:(a=!0,this.store=new h("stash",10))},snapshot:function(){return this.store.push(C.toJson())},stash:function(){return this.snapshot(),C.reset()},"delete":function(){return this.store.pop()},get:function(){return this.store.get()},restore:function(){var a;return a=this.store.get(),a?C.restore(a):J.error("stash is empty")},list:function(){var a,b;return a=function(){var a,c,d,e;for(d=this.store.getIndex(),e=[],a=0,c=d.length;c>a;a++)b=d[a],e.push({key:b.key,date:new Date(b.date).toString()});return e}.call(this),words.readableJson(a)}}}(),this.words=function(){return{humanize:function(a){var b;return b=$.trim(a).replace(/([a-z\d])([A-Z]+)/g,"$1 $2").toLowerCase(),this.titleize(b)},capitalize:function(a){return a=null==a?"":String(a),a.charAt(0).toUpperCase()+a.slice(1)},titleize:function(a){return null==a?"":String(a).replace(/(?:^|\s)\S/g,function(a){return a.toUpperCase()})},snakeCase:function(a){return $.trim(a).replace(/([A-Z])/g,"-$1").replace(/[-_\s]+/g,"-").toLowerCase()},prefix:function(a,b){return 0===b.indexOf(a)?b:""+a+b},readableJson:function(a){return JSON.stringify(a,null,2)}}}(),e=function(){function a(){}return a.prototype.history=[],a.prototype.add=function(){},a.prototype.saved=function(){},a.prototype.isDirty=function(){return 0===history.length?!1:void 0},a}(),f=function(){function a(){}return a}(),l=function(){function a(a){this.snippets=a,null==this.snippets&&(this.snippets=[]),this.createPseudoArray()}return a.prototype.createPseudoArray=function(){var a,b,c,d,e;for(e=this.snippets,a=c=0,d=e.length;d>c;a=++c)b=e[a],this[a]=b;return this.length=this.snippets.length,this.snippets.length?(this.first=this[0],this.last=this[this.snippets.length-1]):void 0},a.prototype.each=function(a){var b,c,d,e;for(e=this.snippets,c=0,d=e.length;d>c;c++)b=e[c],a(b);return this},a.prototype.remove=function(){return this.each(function(a){return a.remove()}),this},a}(),m=function(){function a(a){var b;this.parentSnippet=a.parentSnippet,this.name=a.name,b=a.isRoot,this.isRoot=null!=b,this.first=this.last=void 0}return a.prototype.prepend=function(a){return this.first?this.insertBefore(this.first,a):this.attachSnippet(a),this},a.prototype.append=function(a){return null!=this.parentSnippet&&a===this.parentSnippet&&J.error("cannot append snippet to itself"),this.last?this.insertAfter(this.last,a):this.attachSnippet(a),this},a.prototype.insertBefore=function(a,b){var c;if(a.previous!==b)return a===b&&J.error("cannot insert snippet before itself"),c={previous:a.previous,next:a,parentContainer:a.parentContainer},this.attachSnippet(b,c)},a.prototype.insertAfter=function(a,b){var c;if(a.next!==b)return a===b&&J.error("cannot insert snippet after itself"),c={previous:a,next:a.next,parentContainer:a.parentContainer},this.attachSnippet(b,c)},a.prototype.up=function(a){return null!=a.previous?this.insertBefore(a.previous,a):void 0},a.prototype.down=function(a){return null!=a.next?this.insertAfter(a.next,a):void 0},a.prototype.getSnippetTree=function(){var a;return this.snippetTree||(null!=(a=this.parentSnippet)?a.snippetTree:void 0)},a.prototype.each=function(a){var b,c;for(b=this.first,c=[];b;)b.descendantsAndSelf(a),c.push(b=b.next);return c},a.prototype.eachContainer=function(a){return a(this),this.each(function(b){var c,d,e;d=b.containers,e=[];for(M in d)c=d[M],e.push(a(c));return e})},a.prototype.all=function(a){return a(this),this.each(function(b){var c,d,e;a(b),d=b.containers,e=[];for(M in d)c=d[M],e.push(a(c));return e})},a.prototype.remove=function(a){return a.destroy(),this._detachSnippet(a)},a.prototype.ui=function(){var a;return this.uiInjector||(a=this.getSnippetTree(),a.renderer.createInterfaceInjector(this)),this.uiInjector},a.prototype.attachSnippet=function(a,b){var c,d,e=this;return null==b&&(b={}),c=function(){return e.link(a,b)},(d=this.getSnippetTree())?d.attachingSnippet(a,c):c()},a.prototype._detachSnippet=function(a){var b,c,d=this;return b=function(){return d.unlink(a)},(c=this.getSnippetTree())?c.detachingSnippet(a,b):b()},a.prototype.link=function(a,b){return a.parentContainer&&this.unlink(a),b.parentContainer||(b.parentContainer=this),this.setSnippetPosition(a,b)},a.prototype.unlink=function(a){var b,c,d;return b=a.parentContainer,b?(null==a.previous&&(b.first=a.next),null==a.next&&(b.last=a.previous),null!=(c=a.next)&&(c.previous=a.previous),null!=(d=a.previous)&&(d.next=a.next),this.setSnippetPosition(a,{})):void 0},a.prototype.setSnippetPosition=function(a,b){var c,d,e;return d=b.parentContainer,e=b.previous,c=b.next,a.parentContainer=d,a.previous=e,a.next=c,d&&(e&&(e.next=a),c&&(c.previous=a),null==a.previous&&(d.first=a),null==a.next)?d.last=a:void 0},a}(),o=function(){function a(a){var b,c;c=null!=a?a:{},this.template=c.template,b=c.id,this.template||J.error("cannot instantiate snippet without template reference"),this.initializeContainers(),this.initializeEditables(),this.initializeImages(),this.id=b||E.next(),this.identifier=this.template.identifier,this.next=void 0,this.previous=void 0,this.snippetTree=void 0}return a.prototype.initializeContainers=function(){var a,b;this.containerCount=this.template.directives.count.container,b=[];for(a in this.template.directives.container)this.containers||(this.containers={}),b.push(this.containers[a]=new m({name:a,parentSnippet:this}));return b},a.prototype.initializeEditables=function(){var a,b;this.editableCount=this.template.directives.count.editable,b=[];for(a in this.template.directives.editable)this.editables||(this.editables={}),b.push(this.editables[a]=void 0);return b},a.prototype.initializeImages=function(){var a,b;this.imageCount=this.template.directives.count.image,b=[];for(a in this.template.directives.image)this.images||(this.images={}),b.push(this.images[a]=void 0);return b},a.prototype.hasImages=function(){return this.imageCount>0},a.prototype.hasContainers=function(){return null!=this.containers},a.prototype.before=function(a){return a?(this.parentContainer.insertBefore(this,a),this):this.previous},a.prototype.after=function(a){return a?(this.parentContainer.insertAfter(this,a),this):this.next},a.prototype.append=function(a,b){return 1===arguments.length&&(b=a,a=Q.defaultValues.container),this.containers[a].append(b),this},a.prototype.prepend=function(a,b){return 1===arguments.length&&(b=a,a=Q.defaultValues.container),this.containers[a].prepend(b),this},a.prototype.set=function(a,b){var c,d;if(null!=(c=this.editables)?c.hasOwnProperty(a):void 0){if(this.editables[a]!==b&&(this.editables[a]=b,this.snippetTree))return this.snippetTree.contentChanging(this)}else{if(null!=(d=this.images)?!d.hasOwnProperty(a):!0)return J.error("set error: "+this.identifier+" has no content named "+a);if(this.images[a]!==b&&(this.images[a]=b,this.snippetTree))return this.snippetTree.contentChanging(this)}},a.prototype.get=function(a){var b,c;return(null!=(b=this.editables)?b.hasOwnProperty(a):void 0)?this.editables[a]:(null!=(c=this.images)?c.hasOwnProperty(a):void 0)?this.images[a]:J.error("get error: "+this.identifier+" has no name named "+a)},a.prototype.copy=function(){return J.warn("SnippetModel#copy() is not implemented yet.")},a.prototype.copyWithoutContent=function(){return this.template.createModel()},a.prototype.hasEditables=function(){return null!=this.editables},a.prototype.up=function(){return this.parentContainer.up(this),this},a.prototype.down=function(){return this.parentContainer.down(this),this},a.prototype.remove=function(){return this.parentContainer.remove(this)},a.prototype.destroy=function(){return this.uiInjector?this.uiInjector.remove():void 0},a.prototype.getParent=function(){var a;return null!=(a=this.parentContainer)?a.parentSnippet:void 0},a.prototype.ui=function(){return this.uiInjector||this.snippetTree.renderer.createInterfaceInjector(this),this.uiInjector},a.prototype.parents=function(a){var b,c;for(b=this,c=[];b=b.getParent();)c.push(a(b));return c},a.prototype.children=function(a){var b,c,d,e;d=this.containers,e=[];for(M in d)b=d[M],c=b.first,e.push(function(){var b;for(b=[];c;)a(c),b.push(c=c.next);return b}());return e},a.prototype.descendants=function(a){var b,c,d,e;d=this.containers,e=[];for(M in d)b=d[M],c=b.first,e.push(function(){var b;for(b=[];c;)a(c),c.descendants(a),b.push(c=c.next);return b}());return e},a.prototype.descendantsAndSelf=function(a){return a(this),this.descendants(a)},a.prototype.descendantContainers=function(a){return this.descendantsAndSelf(function(b){var c,d,e;d=b.containers,e=[];for(M in d)c=d[M],e.push(a(c));return e})},a.prototype.allDescendants=function(a){var b=this;return this.descendantsAndSelf(function(c){var d,e,f;c!==b&&a(c),e=c.containers,f=[];for(M in e)d=e[M],f.push(a(d));return f})},a.prototype.childrenAndSelf=function(a){return a(this),this.children(a)},a.prototype.toJson=function(){var a,b,c;if(a={id:this.id,identifier:this.identifier},this.hasEditables()){a.editables={},b=this.editables;for(M in b)T=b[M],a.editables[M]=T}for(M in this.images){a.images||(a.images={}),c=this.images;for(M in c)T=c[M],a.images[M]=T}for(M in this.containers)a.containers||(a.containers={}),a.containers[M]=[];return a},a}(),o.fromJson=function(a,b){var c,d,e,f,g,h,i,j,k,l,m,n;i=b.get(a.identifier),null==i&&J.error("error while deserializing snippet: unknown template identifier '"+a.identifier+"'"),g=new o({template:i,id:a.id}),l=a.editables;for(e in l)T=l[e],g.editables.hasOwnProperty(e)?g.editables[e]=T:J.error("error while deserializing snippet: unknown editable "+e);m=a.images;for(f in m)T=m[f],g.images.hasOwnProperty(f)?g.images[f]=T:J.error("error while deserializing snippet: unknown image "+f);n=a.containers;for(d in n)if(h=n[d],g.containers.hasOwnProperty(d)||J.error("error while deserializing snippet: unknown container "+d),h)for($.isArray(h)||J.error("error while deserializing snippet: container is not array "+d),j=0,k=h.length;k>j;j++)c=h[j],g.append(d,o.fromJson(c,b));return g},u=function(){function a(a){var b,c,d;d=null!=a?a:{},b=d.content,c=d.design,this.root=new m({isRoot:!0}),null!=b&&null!=c&&this.fromJson(b,c),this.root.snippetTree=this,this.history=new e,this.initializeEvents()}return a.prototype.prepend=function(a){return this.root.prepend(a),this},a.prototype.append=function(a){return this.root.append(a),this},a.prototype.initializeEvents=function(){return this.snippetAdded=$.Callbacks(),this.snippetRemoved=$.Callbacks(),this.snippetMoved=$.Callbacks(),this.snippetContentChanged=$.Callbacks(),this.snippetHtmlChanged=$.Callbacks(),this.snippetSettingsChanged=$.Callbacks(),this.changed=$.Callbacks()},a.prototype.each=function(a){return this.root.each(a)},a.prototype.eachContainer=function(a){return this.root.eachContainer(a)},a.prototype.all=function(a){return this.root.all(a)},a.prototype.find=function(a){var b;return"string"==typeof a?(b=[],this.each(function(c){return c.identifier===a||c.template.id===a?b.push(c):void 0}),new l(b)):new l},a.prototype.detach=function(){var a;return this.root.snippetTree=void 0,this.each(function(a){return a.snippetTree=void 0}),a=this.root,this.root=new m({isRoot:!0}),a},a.prototype.print=function(){var a,b,c;return b="SnippetTree\n-----------\n",a=function(a,c){return null==c&&(c=0),b+=""+Array(c+1).join(" ")+a+"\n"},c=function(b,d){var e,f,g;null==d&&(d=0),f=b.template,a("- "+f.title+" ("+f.identifier+")",d),g=b.containers;for(M in g)e=g[M],a(""+M+":",d+2),e.first&&c(e.first,d+4);return b.next?c(b.next,d):void 0},this.root.first&&c(this.root.first),b},a.prototype.attachingSnippet=function(a,b){var c=this;return a.snippetTree===this?(b(),this.fireEvent("snippetMoved",a)):(null!=a.snippetTree&&a.snippetContainer.detachSnippet(a),a.descendantsAndSelf(function(a){return a.snippetTree=c}),b(),this.fireEvent("snippetAdded",a))},a.prototype.fireEvent=function(){var a,b;return b=arguments[0],a=2<=arguments.length?U.call(arguments,1):[],this[b].fire.apply(b,a),this.changed.fire()},a.prototype.detachingSnippet=function(a,b){return a.snippetTree===this?(a.descendantsAndSelf(function(a){return a.snippetTree=void 0}),b(),this.fireEvent("snippetRemoved",a)):J.error("cannot remove snippet from another SnippetTree")},a.prototype.contentChanging=function(a){return this.fireEvent("snippetContentChanged",a)},a.prototype.printJson=function(){return words.readableJson(this.toJson())},a.prototype.toJson=function(){var a,b,c;return a={},a.content=[],b=function(a,b,c){var d;return d=a.toJson(),c.push(d),d},c=function(a,d,e){var f,g,h,i;h=b(a,d,e),i=a.containers;for(M in i)g=i[M],f=h.containers[g.name]=[],g.first&&c(g.first,d+1,f);return a.next?c(a.next,d,e):void 0},this.root.first&&c(this.root.first,0,a.content),a},a.prototype.fromJson=function(a,b){var c,d,e,f,g,h=this;for(this.root.snippetTree=void 0,g=a.content,e=0,f=g.length;f>e;e++)d=g[e],c=o.fromJson(d,b),this.root.append(c);return this.root.snippetTree=this,this.root.each(function(a){return a.snippetTree=h})},a}(),p=function(){function a(a){this.htmlNode=a,this.parseAttributes()}var b;return b=/^(x-|data-)/,a.prototype.parseAttributes=function(){var a,c,d,e,f,g,h;for(h=this.htmlNode.attributes,f=0,g=h.length;g>f;f++)if(a=h[f],c=a.name,d=c.replace(b,""),e=R[d])return this.isDataNode=!0,this.type=e,this.name=a.value||Q.defaultValues[this.type],c!==A[this.type]?this.normalizeAttribute(c):a.value||this.normalizeAttribute(),void 0},a.prototype.normalizeAttribute=function(a){return a&&this.htmlNode.removeAttribute(a),this.htmlNode.setAttribute(A[this.type],this.name)},a}(),r=function(){function a(a){this.all=null!=a?a:{},this.count={}}return a.prototype.add=function(a){var b;return this.assertNodeNameNotUsed(a),this.all[a.name]=a,this[b=a.type]||(this[b]={}),this[a.type][a.name]=a.htmlNode,this.count[a.type]=this.count[a.type]?this.count[a.type]+1:1},a.prototype.assertNodeNameNotUsed=function(a){return this.all[a.name]?J.error(""+a.type+" Template parsing error: "+A[a.type]+'="'+a.name+'".\n"'+a.name+'" is a duplicate name.'):void 0},a}(),t=function(){function a(a,b){var c;this.name=a,this.$list=b,c=this.$list.children().first().detach(),this._item=new w({id:""+this.id+"-item",html:c})}return a.prototype.content=function(a){var b,c,d,e;if(this.isEmpty()||this.clear(),$.isArray(a)){for(e=[],c=0,d=a.length;d>c;c++)b=a[c],e.push(this.add(b));return e}return this.add(a)},a.prototype.add=function(a,b){var c,d,e,f,g,h,i;if($.isArray(a)){for(i=[],g=0,h=a.length;h>g;g++)f=a[g],i.push(this.add(f,b));return i}c=this._item.create(a);for(d in b)e=b[d],c.on(d,e);return this.$list.append(c)},a.prototype.remove=function(a){return void 0===a||-1===a?this.$list.children(":last").remove():this.$list.children(":nth-child("+(a+1)+")").remove()},a.prototype.clear=function(){return this.$list.children().remove()},a.prototype.isEmpty=function(){return!this.$list.children().length},a}(),w=function(){function a(b){var c,d,e,f,g,h,i,j;i=null!=b?b:{},c=i.html,this.namespace=i.namespace,this.id=i.id,d=i.identifier,f=i.title,e=i.styles,h=i.weight,g=i.version,c||J.error("Template: param html missing"),d&&(j=a.parseIdentifier(d),this.namespace=j.namespace,this.id=j.id),this.identifier=this.namespace&&this.id?""+this.namespace+"."+this.id:void 0,this.version=g||1,this.$template=$(this.pruneHtml(c)).wrap("<div>"),this.$wrap=this.$template.parent(),this.title=f||words.humanize(this.id),this.styles=e||[],this.weight=h,this.editables=void 0,this.editableCount=0,this.containers=void 0,this.containerCount=0,this.defaults={},this.parseTemplate(),this.lists=this.createLists()}return a.prototype.createModel=function(){return new o({template:this})},a.prototype.createView=function(a){var b,c,d;return a||(a=this.createModel()),b=this.$template.clone(),c=this.getNodeLinks(b[0]),d=new v({model:a,$html:b,editables:c.editable,containers:c.container,images:c.image})},a.prototype.pruneHtml=function(a){return a},a.prototype.parseTemplate=function(){var a,b,c,d,e;b=this.$template[0],this.directives=this.getNodeLinks(b),this.editables=this.directives.editable,this.containers=this.directives.container,this.editableCount=this.directives.count.editable,this.containerCount=this.directives.count.container,c=this.editables;for(M in c)a=c[M],this.formatEditable(M,a);d=this.containers,e=[];for(M in d)a=d[M],e.push(this.formatContainer(M,a));return e},a.prototype.getNodeLinks=function(a){var b,c,d,e;for(c=new q(a),d=new r;b=c.nextElement();)e=new p(b),e.isDataNode&&d.add(e);return d},a.prototype.formatEditable=function(a,b){var c,d;return c=$(b),c.addClass(B.editable),d=b.innerHTML,d?this.defaults[a]=d:void 0},a.prototype.formatContainer=function(a,b){return b.innerHTML=""},a.prototype.createLists=function(){var a;return a={},this.$wrap.find("["+A.list+"]").each(function(){var b,c;return b=$(this),c=b.attr(""+A.list),a[c]=new t(c,b)}),a},a.prototype.list=function(a){return this.lists[a]},a.prototype.printDoc=function(){var a;return a={identifier:this.identifier,editables:this.editables?Object.keys(this.editables):void 0,containers:this.containers?Object.keys(this.containers):void 0},words.readableJson(a)},a}(),w.parseIdentifier=function(a){var b;if(a)return b=a.split("."),1===b.length?{namespace:void 0,id:b[0]}:2===b.length?{namespace:b[0],id:b[1]}:(J.error("could not parse snippet template identifier: "+a),{namespace:void 0,id:void 0})},a=function(){function a(a){var b,c;c=a.templates||a.snippets,z=a.config,b=a.config.groups||a.groups,this.namespace=(null!=z?z.namespace:void 0)||"livingdocs-templates",this.css=z.css,this.js=z.js,this.fonts=z.fonts,this.templates=[],this.templatesCount=0,this.groups={},this.addTemplates(c),this.addGroups(b)}return a.prototype.add=function(a){var b;return this.templatesCount=this.templatesCount+1,b=new w({namespace:this.namespace,id:a.id,title:a.title,styles:a.styles,html:a.html,weight:this.templatesCount}),this.templates.push(b)},a.prototype.addTemplates=function(a){var b,c,d,e;for(e=[],c=0,d=a.length;d>c;c++)b=a[c],e.push(this.add(b));return e},a.prototype.addGroups=function(a){var b,c,d,e,f,g,h;h=[];for(G in a){for(b=a[G],d={},g=b.templates,e=0,f=g.length;f>e;e++)c=g[e],d[c]=this.get(c);h.push(this.groups[G]=new Object({title:b.title,templates:d}))}return h},a.prototype.remove=function(a){var b=this;return this.checkNamespace(a,function(a){return b.templates.splice(b.getIndex(a),1)})},a.prototype.get=function(a){var b=this;return this.checkNamespace(a,function(a){var c;return c=void 0,b.each(function(b){return b.id===a?c=b:void 0}),c})},a.prototype.getIndex=function(a){var b=this;return this.checkNamespace(a,function(a){var c;return c=void 0,b.each(function(b,d){return b.id===a?c=d:void 0}),c})},a.prototype.checkNamespace=function(a,b){var c,d,e;return e=w.parseIdentifier(a),d=e.namespace,c=e.id,d&&this.namespace!==d?J.error("design "+this.namespace+": cannot get template with different namespace "+d+" "):b(c)},a.prototype.each=function(a){var b,c,d,e,f,g;for(f=this.templates,g=[],b=d=0,e=f.length;e>d;b=++d)c=f[b],g.push(a(c,b));return g},a.prototype.list=function(){var a;return a=[],this.each(function(b){return a.push(b.identifier)}),a},a.prototype.info=function(a){var b;return b=this.get(a),b.printDoc()},a}(),C=function(){var b,c,d;return d=1,c=function(){return d-=1,0===d?C.ready.fire():void 0},b=function(){return d+=1,c},{initialized:!1,uniqueId:0,ready:$.Callbacks("memory once"),changed:$.Callbacks(),init:function(a){var d,e,f,g,h=this;return g=null!=a?a:{},d=g.design,e=g.json,f=g.rootNode,this.initialized&&J.error("document is already initialized"),this.initialized=!0,this.loadDesign(d),this.snippetTree=e&&this.design?new u({content:e,design:this.design}):new u,this.snippetTree.changed.add(function(){return h.changed.fire()}),this.page=new j,this.design.css&&this.page.loader.css(this.design.css,b()),f||(f=this.page.getDocumentSection()[0]),this.renderer=new k({snippetTree:this.snippetTree,rootNode:f,page:this.page}),this.ready.add(function(){return h.renderer.render()}),c()},loadDesign:function(b){return this.design=new a(b)},eachContainer:function(a){return this.snippetTree.eachContainer(a)},add:function(a){var b;return b="string"===jQuery.type(a)?this.createModel(a):a,b&&this.snippetTree.append(b),b},createModel:function(a){var b;return b=this.getTemplate(a),b?b.createModel():void 0},find:function(a){return this.snippetTree.find(a)},printTree:function(){return this.snippetTree.print()},toJson:function(){var a;return a=this.snippetTree.toJson(),a.meta={title:void 0,author:void 0,created:void 0,published:void 0},a},restore:function(a,b){return null==b&&(b=!0),b&&this.reset(),this.snippetTree.fromJson(a,this.design),this.renderer.render()},reset:function(){return this.renderer.clear(),this.snippetTree.detach()},getTemplate:function(a){var b,c;return b=null!=(c=this.design)?c.get(a):void 0,b||J.error("could not find template "+a),b}}}(),D=function(){var a,b;return b=new RegExp("(?: |^)"+B.snippet+"(?: |$)"),a=new RegExp("(?: |^)"+B.section+"(?: |$)"),{findSnippetView:function(a){var c;for(a=this.getElementNode(a);a&&1===a.nodeType;){if(b.test(a.className))return c=this.getSnippetView(a);a=a.parentNode}return void 0},findContainer:function(b){var c,d;for(b=this.getElementNode(b);b&&1===b.nodeType;){if(b.hasAttribute(A.container))return c=b.getAttribute(A.container),a.test(b.className)||(d=this.findSnippetView(b)),{node:b,containerName:c,snippetView:d};b=b.parentNode}return{}},getImageName:function(a){var b;return a.hasAttribute(A.image)?b=a.getAttribute(A.image):void 0},getEditableName:function(a){var b;return a.hasAttribute(A.editable)?(b=a.getAttribute(A.editable),editableName):void 0},dropTarget:function(c,d){var e,f,g,h,i,j,k;for(j=d.top,h=d.left,c=this.getElementNode(c);c&&1===c.nodeType;){if(c.hasAttribute(A.container)){if(e=c.getAttribute(A.container),!a.test(c.className))return g=this.getPositionInContainer($(c),{top:j,left:h}),g?(f=this.getInsertPosition(g.$elem[0],g.position),{snippetView:g.snippetView,position:g.position,coords:f}):(k=this.findSnippetView(c),{containerName:e,parent:k,node:c})}else{if(b.test(c.className))return i=this.getPositionInSnippet($(c),{top:j,left:h}),k=this.getSnippetView(c),f=this.getInsertPosition(c,i.position),{snippetView:k,position:i.position,coords:f};if(a.test(c.className))return{root:!0}}c=c.parentNode}return{}},getInsertPosition:function(a,b){var c;return c=this.getBoundingClientRect(a),"before"===b?{top:c.top,left:c.left,width:c.width}:{top:c.bottom,left:c.left,width:c.width}},getPositionInSnippet:function(a,b){var c,d,e,f,g;return g=b.top,f=b.left,e=a.offset().top,d=a.outerHeight(),c=e+d,this.distance(g,e)<this.distance(g,c)?{position:"before"}:{position:"after"}},getPositionInContainer:function(a,b){var c,d,e,f,g,h=this;return g=b.top,f=b.left,c=a.find("."+B.snippet),d=void 0,e=void 0,c.each(function(a,b){var c,f,i,j;return c=$(b),j=c.offset().top,i=c.outerHeight(),f=j+i,(!d||h.distance(g,j)<d)&&(d=h.distance(g,j),e={$elem:c,position:"before"}),(!d||h.distance(g,f)<d)&&(d=h.distance(g,f),e={$elem:c,position:"after"}),e?e.snippetView=h.getSnippetView(e.$elem[0]):void 0}),e},distance:function(a,b){return a>b?a-b:b-a},maximizeContainerHeight:function(a){var b,c,d,e,f,g,h;if(a.template.containerCount>1){g=a.containers,h=[];for(M in g)d=g[M],b=$(d),b.hasClass(B.maximizedContainer)||(c=b.parent(),f=c.height(),e=b.outerHeight(!0)-b.height(),b.height(f-e),h.push(b.addClass(B.maximizedContainer)));return h}},restoreContainerHeight:function(){return $("."+B.maximizedContainer).css("height","").removeClass(B.maximizedContainer)},getElementNode:function(a){return(null!=a?a.jquery:void 0)?a[0]:3===(null!=a?a.nodeType:void 0)?a.parentNode:a},getSnippetView:function(a){return $(a).data("snippet")},getBoundingClientRect:function(a){var b,c,d;return b=a.getBoundingClientRect(),c=void 0!==window.pageXOffset?window.pageXOffset:(C.documentElement||window.document.body.parentNode||window.document.body).scrollLeft,d=void 0!==window.pageYOffset?window.pageYOffset:(C.documentElement||window.document.body.parentNode||window.document.body).scrollTop,b={top:b.top+d,bottom:b.bottom+d,left:b.left+c,right:b.right+c},b.height=b.bottom-b.top,b.width=b.right-b.left,b}}}(),b=function(){function a(b){this.defaultOptions=$.extend({longpressDelay:0,longpressDistanceLimit:10,minDistance:0,direct:!1,preventDefault:!0,createPlaceholder:a.placeholder},b),this.drag={},this.$origin=void 0,this.$dragged=void 0}return a.prototype.mousedown=function(a,b,c){var d=this;return null==c&&(c={}),this.reset(),this.drag.initialized=!0,this.options=$.extend({},this.defaultOptions,c),this.drag.startPoint={left:b.pageX,top:b.pageY},this.$origin=a,this.options.longpressDelay&&this.options.longpressDistanceLimit&&(this.drag.timeout=setTimeout(function(){return d.start()},this.options.longpressDelay)),this.options.preventDefault?b.preventDefault():void 0},a.prototype.start=function(){var a,b,c;return this.drag.started=!0,a=this.drag.startPoint.left,b=this.drag.startPoint.top,"function"==typeof this.options.onDragStart&&this.options.onDragStart.call(this,this.drag,{left:a,top:b}),$(window.document.body).addClass(B.preventSelection),this.$dragged=this.options.direct?this.$origin:this.options.createPlaceholder(this.drag,this.$origin),this.drag.fixed&&(this.drag.$body=$(window.document.body)),this.move(a,b),this.direct?void 0:(this.$dragged.appendTo(window.document.body).show(),null!=(c=this.$origin)?c.addClass(B.dragged):void 0)},a.prototype.move=function(a,b,c){var d,e;if(this.drag.started){if(this.drag.mouseToSnippet?(d=a-this.drag.mouseToSnippet.left,e=b-this.drag.mouseToSnippet.top):(d=a,e=b),this.drag.fixed&&(e-=this.drag.$body.scrollTop(),d-=this.drag.$body.scrollLeft()),2>d&&(d=2),2>e&&(e=2),this.$dragged.css({position:"absolute",left:""+d+"px",top:""+e+"px"}),!this.direct)return this.dropTarget(a,b,c)
}else if(this.drag.initialized&&(this.options.longpressDelay&&this.options.longpressDistanceLimit&&this.distance({left:a,top:b},this.drag.startPoint)>this.options.longpressDistanceLimit&&this.reset(),this.options.minDistance&&this.distance({left:a,top:b},this.drag.startPoint)>this.options.minDistance))return this.start()},a.prototype.drop=function(){return this.drag.started&&"function"==typeof this.options.onDrop&&this.options.onDrop.call(this,this.drag,this.$origin),this.reset()},a.prototype.dropTarget=function(a,b,c){var d,e;return this.$dragged&&c&&(e=void 0,c.clientX&&c.clientY&&(this.$dragged.hide(),e=window.document.elementFromPoint(c.clientX,c.clientY),this.$dragged.show()),e?(d=D.dropTarget(e,{top:b,left:a}),this.drag.target=d):this.drag.target={},"function"==typeof this.options.onDrag)?this.options.onDrag.call(this,this.drag.target,this.drag,{left:a,top:b}):void 0},a.prototype.distance=function(a,b){var c,d;return a&&b?(c=a.left-b.left,d=a.top-b.top,Math.sqrt(c*c+d*d)):void 0},a.prototype.reset=function(){return this.drag.initialized?(this.drag.timeout&&clearTimeout(this.drag.timeout),this.drag.preview&&this.drag.preview.remove(),this.$dragged&&this.$dragged!==this.$origin&&this.$dragged.remove(),this.$origin&&(this.$origin.removeClass(B.dragged),this.$origin.show()),$(window.document.body).removeClass(B.preventSelection),this.drag={},this.$origin=void 0,this.$dragged=void 0):void 0},a}(),b.cloneOrigin=function(a,b){var c,d,e,f,g,h,i;return a.mouseToSnippet||(h=b.offset(),g=parseFloat(b.css("margin-top")),f=parseFloat(b.css("margin-left")),a.mouseToSnippet={left:mouseLeft-h.left+f,top:mouseTop-h.top+g}),i=a.width||b.width(),d=b.clone(),d.css({position:"absolute",width:i}).removeClass(B.snippetHighlight).addClass(B.draggedPlaceholder),c=b.css("background-color"),e="transparent"!==c&&"rgba(0, 0, 0, 0)"!==c,e||d.css({"background-color":"#fff"}),d},b.placeholder=function(a){var b,c,d,e;return d=a.width,c=1,a.mouseToSnippet||(a.mouseToSnippet={left:2,top:-15}),e='<div class="doc-drag-placeholder-item">\n  <span class="doc-drag-counter">'+c+"</span>\n  Selected Item\n</div>",b=$(e),d&&b.css({width:d}),b.css({position:"absolute"})},c=function(){function a(a){var b;this.page=a,this.lastMouseEvent=null,b=this,window.document.body.onmousedown=function(a){return b.lastMouseEvent=a},window.document.body.onmouseup=function(a){return b.lastMouseEvent=a},Editable.init({log:!1}),this.selection=$.Callbacks(),Editable.focus($.proxy(this.focus,this)).blur($.proxy(this.blur,this)).insert($.proxy(this.insert,this)).merge($.proxy(this.merge,this)).split($.proxy(this.split,this)).selection($.proxy(this.selectionChanged,this))}return a.prototype.add=function(a){return Editable.add(a)},a.prototype.focus=function(a){var b;return b=D.findSnippetView(a),this.page.focus.editableFocused(a,b)},a.prototype.blur=function(a){var b,c;return c=D.findSnippetView(a),this.page.focus.editableBlurred(a,c),b=a.getAttribute(A.editable),c.model.set(b,a.innerHTML)},a.prototype.insert=function(a,b){var c,d,e,f;return f=D.findSnippetView(a),1===f.model.editableCount&&(e=C.design.get("text"),c=e.createModel(),d="before"===b?(f.model.before(c),f.prev()):(f.model.after(c),f.next()),d&&d.focus()),!1},a.prototype.merge=function(a,b){var c,d;return d=D.findSnippetView(a),1===d.model.editableCount&&(c="before"===b?d.prev():d.next(),c&&c.focus(),c.template===d.template&&d.model.remove()),J("engine: merge"),!1},a.prototype.split=function(a){var b;return b=D.findSnippetView(a),J("engine: split"),!1},a.prototype.selectionChanged=function(a,b){var c;return c=D.findSnippetView(a),this.selection.fire(c,a,b,this.lastMouseEvent)},a}(),d=function(){function a(){this.editableNode=void 0,this.snippetView=void 0,this.snippetFocus=$.Callbacks(),this.snippetBlur=$.Callbacks()}return a.prototype.setFocus=function(a,b){return b!==this.editableNode&&(this.resetEditable(),this.editableNode=b),a!==this.snippetView&&(this.resetSnippetView(),a)?(this.snippetView=a,this.snippetFocus.fire(this.snippetView)):void 0},a.prototype.editableFocused=function(a,b){return this.editableNode!==a?(b||(b=D.findSnippetView(a)),this.setFocus(b,a)):void 0},a.prototype.editableBlurred=function(a){return this.editableNode===a?this.setFocus(this.snippetView,void 0):void 0},a.prototype.snippetFocused=function(a){return this.snippetView!==a?this.setFocus(a,void 0):void 0},a.prototype.blur=function(){return this.setFocus(void 0,void 0)},a.prototype.resetEditable=function(){return this.editableNode?this.editableNode=void 0:void 0},a.prototype.resetSnippetView=function(){var a;return this.snippetView?(a=this.snippetView,this.snippetView=void 0,this.snippetBlur.fire(a)):void 0},a}(),g=function(){function a(a){var b,c,d;this.snippet=a.snippet,this.snippetContainer=a.snippetContainer,this.renderer=a.renderer,this.snippet&&!(null!=(b=this.snippet.snippetView)?b.attachedToDom:void 0)&&J.error("snippet is not attached to the DOM"),this.snippetContainer&&(this.snippetContainer.isRoot||(null!=(c=this.snippetContainer.parentSnippet)?null!=(d=c.snippetView)?d.attachedToDom:void 0:void 0)||J.error("snippetContainer is not attached to the DOM"))}return a.prototype.before=function(a){return this.snippet?(this.beforeInjecting(a),this.snippet.snippetView.$html.before(a)):J.error("cannot use before on a snippetContainer")},a.prototype.after=function(a){return this.snippet?(this.beforeInjecting(a),this.snippet.snippetView.$html.after(a)):J.error("cannot use after on a snippetContainer")},a.prototype.append=function(a){return this.snippetContainer?(this.beforeInjecting(a),this.renderer.appendToContainer(this.snippetContainer,a)):J.error("cannot use append on a snippet")},a.prototype.remove=function(){var a,b,c,d;for(d=this.injected,b=0,c=d.length;c>b;b++)a=d[b],a.remove();return this.injected=void 0},a.prototype.beforeInjecting=function(a){return this.injected||(this.injected=[]),this.injected.push(a),a.addClass(B["interface"])},a}(),H=function(){return{init:function(a,b){var c;return c=$(a).children().not("script"),$(a).html('<div class="doc-section"></div>'),doc.init({design:b}),doc.ready(function(){var a,b,d,e;return a=function(a){return a.tagName?$.camelCase(a.tagName.toLowerCase()):null},b=function(b,c){var e,f,g,h,i,j,k,l,m,n;if(g=b.containers?Object.keys(b.containers):[],1===g.length&&-1!==g.indexOf("default")&&!$(c).children("default").length)for(f=$(c).children(),j=0,l=f.length;l>j;j++)e=f[j],d(b,"default",e);for(i=$(g.join(","),c),n=[],k=0,m=i.length;m>k;k++)h=i[k],f=$(h).children(),n.push(function(){var c,g,i;for(i=[],c=0,g=f.length;g>c;c++)e=f[c],i.push(d(b,a(h),e));return i}());return n},d=function(c,d,f){var g;return g=doc.create(a(f)),c.append(d,g),b(g,f),e(g,f)},e=function(a,b){var c,d;if(a.hasEditables()){d=[];for(G in a.editables)a.set(G,null),c=$(G+":first",b).get()[0],c?d.push(a.set(G,c.innerHTML)):d.push(a.set(G,b.innerHTML));return d}},c.each(function(c,d){var f;return f=doc.add(a(d)),b(f,d),e(f,d)})})}}}(),i=function(){function a(){this.loadedCssFiles=[]}return a.prototype.replaceCss=function(a,b){return this.removeCss(),this.css(a,b)},a.prototype.css=function(a,b){var c,d;return $.isArray(a)||(a=[a]),a=function(){var b,c,e;for(e=[],b=0,c=a.length;c>b;b++)d=a[b],this.loadedCssFiles.push(d),e.push(words.prefix("css!",d));return e}.call(this),c=a.length,yepnope({load:a,callback:function(){return c-=1,b&&0>=c?b():void 0}})},a.prototype.removeCss=function(a){var b,c,d;for(null==a||$.isArray(a)||(a=[a]),a=a||this.loadedCssFiles,c=0,d=a.length;d>c;c++)b=a[c],$("link[rel=stylesheet][href~='"+b+"']").remove();return this.loadedCssFiles=[]},a}(),j=function(){function a(){this.$document=$(window.document),this.$body=$(window.document.body),this.loader=new i,this.focus=new d,this.imageClick=$.Callbacks(),this.editableController=new c(this),this.snippetDragDrop=new b({longpressDelay:400,longpressDistanceLimit:10,preventDefault:!1}),this.$document.on("click.livingdocs",$.proxy(this.click,this)).on("mousedown.livingdocs",$.proxy(this.mousedown,this)).on("dragstart",$.proxy(this.browserDragStart,this))}return a.prototype.browserDragStart=function(a){return a.preventDefault(),a.stopPropagation()},a.prototype.removeListeners=function(){return this.$document.off(".livingdocs"),this.$document.off(".livingdocs-drag")},a.prototype.getDocumentSection=function(a){var b,c;return c=(null!=a?a:{}).rootNode,b=c?$(c).addClass("."+B.section):$("."+B.section).first(),b.length||J.error("no rootNode found"),b},a.prototype.mousedown=function(a){var b;if(1===a.which)return b=D.findSnippetView(a.target),b?this.startDrag({snippetView:b,dragDrop:this.snippetDragDrop}):void 0},a.prototype.startDrag=function(a){var b,c,d,e,f,g=this;return d=a.snippet,f=a.snippetView,c=a.dragDrop,d||f?(f&&(d=f.model),this.$document.on("mousemove.livingdocs-drag",function(a){return c.move(a.pageX,a.pageY,a)}),this.$document.on("mouseup.livingdocs-drag",function(){return c.drop(),g.$document.off(".livingdocs-drag")}),e=new n({snippet:d,page:this}),f&&(b=f.$html),c.mousedown(b,event,{onDragStart:e.onStart,onDrag:e.onDrag,onDrop:e.onDrop})):void 0},a.prototype.click=function(a){var b,c;return c=D.findSnippetView(a.target),c?(this.focus.snippetFocused(c),(b=D.getImageName(a.target))?this.imageClick.fire(c,b,a):void 0):this.focus.blur()},a.prototype.getFocusedElement=function(){return window.document.activeElement},a.prototype.blurFocusedElement=function(){var a;return this.focus.setFocus(void 0),a=this.getFocusedElement(),a?$(a).blur():void 0},a}(),k=function(){function a(a){var b;this.snippetTree=a.snippetTree,b=a.rootNode,this.page=a.page,this.snippetTree||J.error("no snippet tree specified"),b||J.error("no root node specified"),this.$root=$(b),this.setupPageListeners(),this.setupSnippetTreeListeners(),this.snippets={}}return a.prototype.setupPageListeners=function(){return this.page.focus.snippetFocus.add($.proxy(this,"highlightSnippet")),this.page.focus.snippetBlur.add($.proxy(this,"removeSnippetHighlight"))},a.prototype.setupSnippetTreeListeners=function(){return this.snippetTree.snippetAdded.add($.proxy(this,"snippetAdded")),this.snippetTree.snippetRemoved.add($.proxy(this,"snippetRemoved")),this.snippetTree.snippetMoved.add($.proxy(this,"snippetMoved")),this.snippetTree.snippetContentChanged.add($.proxy(this,"snippetContentChanged"))},a.prototype.snippetAdded=function(a){var b;return b=this.ensureSnippetView(a),this.updateDomPosition(b)},a.prototype.snippetRemoved=function(a){var b;return(b=this.getSnippetView(a))&&b.attachedToDom?(this.detachFromDom(b),delete this.snippets[a.id]):void 0},a.prototype.snippetMoved=function(a){var b;return b=this.ensureSnippetView(a),this.updateDomPosition(b)},a.prototype.snippetContentChanged=function(a){var b;return b=this.ensureSnippetView(a),b.attachedToDom||this.insertIntoDom(b),b.updateContent()},a.prototype.getSnippetView=function(a){return a?this.snippets[a.id]:void 0},a.prototype.ensureSnippetView=function(a){return a?this.snippets[a.id]||this.createSnippetView(a):void 0},a.prototype.createSnippetView=function(a){var b;return b=a.template.createView(a),this.snippets[a.id]=b},a.prototype.render=function(){var a=this;return this.$root.empty(),this.snippetTree.each(function(b){var c;return c=a.ensureSnippetView(b),a.insertIntoDom(c)})},a.prototype.clear=function(){var a=this;return this.snippetTree.each(function(b){var c;return c=a.getSnippetView(b),null!=c?c.attachedToDom=!1:void 0}),this.$root.empty()},a.prototype.redraw=function(){return this.clear(),this.render()},a.prototype.updateDomPosition=function(a){return a.attachedToDom&&this.detachFromDom(a),this.insertIntoDom(a)},a.prototype.insertIntoDom=function(a){return a.attach(this),a.attachedToDom||J.error("could not insert snippet into Dom"),this.afterDomInsert(a),this},a.prototype.afterDomInsert=function(a){var b,c;return b=function(){var b,d;b=a.editables,d=[];for(M in b)c=b[M],d.push(c);return d}(),this.page.editableController.add(b)},a.prototype.detachFromDom=function(a){return a.detach(),this},a.prototype.highlightSnippet=function(a){return a.$html.addClass(B.snippetHighlight)},a.prototype.removeSnippetHighlight=function(a){return a.$html.removeClass(B.snippetHighlight)},a.prototype.createInterfaceInjector=function(a){return a instanceof o?this.createSnippetInterfaceInjector(a):a instanceof m?this.createSnippetContainerInterfaceInjector(a):void 0},a.prototype.createSnippetInterfaceInjector=function(a){return void 0===a.uiInjector?a.uiInjector=new g({snippet:a,renderer:this}):void 0},a.prototype.createSnippetContainerInterfaceInjector=function(a){return void 0===a.uiInjector?a.uiInjector=new g({snippetContainer:a,renderer:this}):void 0},a}(),n=function(){function a(a){var b,c;c=a.snippet,b=a.page,this.snippet=c,this.page=b,this.$highlightedContainer={},this.onStart=$.proxy(this.onStart,this),this.onDrag=$.proxy(this.onDrag,this),this.onDrop=$.proxy(this.onDrop,this),this.classAdded=[]}return a.prototype.onStart=function(){return this.$insertPreview=$("<div class='doc-drag-preview'>"),this.page.$body.append(this.$insertPreview).css("cursor","pointer"),this.page.blurFocusedElement()},a.prototype.removeCssClasses=function(){var a,b,c,d;for(d=this.classAdded,b=0,c=d.length;c>b;b++)a=d[b],a.removeClass(B.afterDrop).removeClass(B.beforeDrop);return this.classAdded=[]},a.prototype.isValidTarget=function(a){return a.snippetView&&a.snippetView.model!==this.snippet?!0:a.containerName?!0:!1},a.prototype.onDrag=function(a){var b,c,d,e;return this.isValidTarget(a)||(b=a={}),a.containerName?(D.maximizeContainerHeight(a.parent),b=$(a.node)):a.snippetView?(D.maximizeContainerHeight(a.snippetView),b=a.snippetView.get$container(),b.addClass(B.containerHighlight)):b=a={},b[0]!==this.$highlightedContainer[0]&&("function"==typeof(d=this.$highlightedContainer).removeClass&&d.removeClass(B.containerHighlight),this.$highlightedContainer=b,"function"==typeof(e=this.$highlightedContainer).addClass&&e.addClass(B.containerHighlight)),a.coords?(c=a.coords,this.$insertPreview.css({left:""+c.left+"px",top:""+(c.top-5)+"px",width:""+c.width+"px"}).show()):this.$insertPreview.hide()},a.prototype.onDrop=function(a){var b,c,d;if(this.page.$body.css("cursor",""),this.$insertPreview.remove(),"function"==typeof(d=this.$highlightedContainer).removeClass&&d.removeClass(B.containerHighlight),D.restoreContainerHeight(),c=a.target,c&&this.isValidTarget(c)){if(b=c.snippetView)return"before"===c.position?b.model.before(this.snippet):b.model.after(this.snippet);if(c.containerName)return c.parent.model.append(c.containerName,this.snippet)}},a}(),s=function(){function a(){this.snippets=[]}return a}(),v=function(){function a(a){this.model=a.model,this.$html=a.$html,this.editables=a.editables,this.containers=a.containers,this.images=a.images,this.template=this.model.template,this.attachedToDom=!1,this.$html.data("snippet",this).addClass(B.snippet).attr(A.template,this.template.identifier),this.updateContent()}return a.prototype.updateContent=function(){return this.content(this.model.editables,this.model.images)},a.prototype.next=function(){return this.$html.next().data("snippet")},a.prototype.prev=function(){return this.$html.prev().data("snippet")},a.prototype.focus=function(){var a;return a=this.firstEditableElem(),$(a).focus()},a.prototype.firstEditableElem=function(){var a,b;b=this.editables;for(M in b)return a=b[M]},a.prototype.getBoundingClientRect=function(){return D.getBoundingClientRect(this.$html[0])},a.prototype.content=function(a,b){var c,d;for(c in a)T=a[c],this.set(c,T);d=[];for(c in b)T=b[c],d.push(this.setImage(c,T));return d},a.prototype.getEditable=function(a){if(null!=a)return this.editables[a];for(a in this.editables)return this.editables[a]},a.prototype.setImage=function(a,b){var c;return c=this.images[a],$(c).attr("src",b)},a.prototype.set=function(a,b){var c;return 1===arguments.length&&(b=a,a=void 0),(c=this.getEditable(a))?$(c).html(b):J.error("cannot set value without editable name")},a.prototype.get=function(a){var b;return(b=this.getEditable(a))?$(b).html():J.error("cannot get value without editable name")},a.prototype.append=function(a,b){var c;return c=$(this.containers[a]),c.append(b)},a.prototype.attach=function(a){var b,c,d,e,f;if(!this.attachedToDom)return e=this.model.previous,b=this.model.next,d=this.model.parentContainer,null!=e&&(f=a.getSnippetView(e))&&f.attachedToDom?(f.$html.after(this.$html),this.attachedToDom=!0):null!=b&&(c=a.getSnippetView(b))&&c.attachedToDom?(c.$html.before(this.$html),this.attachedToDom=!0):d&&(this.appendToContainer(d,a),this.attachedToDom=!0),this},a.prototype.appendToContainer=function(a,b){var c;return a.isRoot?b.$root.append(this.$html):(c=b.getSnippetView(a.parentSnippet),c.append(a.name,this.$html))},a.prototype.detach=function(){return this.attachedToDom=!1,this.$html.detach()},a.prototype.get$container=function(){return $(D.findContainer(this.$html[0]).node)},a}(),this.doc=function(a){return C.find(a)},x=y(doc),O=function(){return this.kickstart=x(H,"init"),this.init=x(C,"init"),this.ready=x(C.ready,"add"),this.getDesign=function(){return C.design},this.add=$.proxy(C,"add"),this.create=$.proxy(C,"createModel"),this.toJson=$.proxy(C,"toJson"),this.readableJson=function(){return words.readableJson(C.toJson())},this.printTree=$.proxy(C,"printTree"),this.eachContainer=x(C,"eachContainer"),this.document=C,this.changed=x(C.changed,"add"),this.DragDrop=b,P.init(),this.stash=$.proxy(P,"stash"),this.stash.snapshot=$.proxy(P,"snapshot"),this.stash["delete"]=$.proxy(P,"delete"),this.stash.restore=$.proxy(P,"restore"),this.stash.get=$.proxy(P,"get"),this.stash.list=$.proxy(P,"list"),this.words=words,this.fn=l.prototype},N=function(){var a;return a=C.page,this.restore=x(C,"restore"),this.snippetFocused=x(a.focus.snippetFocus,"add"),this.snippetBlurred=x(a.focus.snippetBlur,"add"),this.startDrag=$.proxy(a,"startDrag"),this.imageClick=x(a.imageClick,"add"),this.textSelection=x(a.editableController.selection,"add")},O.call(doc),doc.ready(function(){return N.call(doc)})}.call(this);